!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/js/",n(n.s=29)}([function(t,e,n){"use strict";var r={inherit:function(t,e){for(var n in t.prototype=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e}(e.prototype),t.prototype.constructor=t,e)t[n]=e[n]},loop:function(t,e){for(var n=0;n<t;n++)e(n)},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(r.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(r.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t;return"rgb("+parseInt(e.substring(0,2),16)+", "+parseInt(e.substring(2,4),16)+", "+parseInt(e.substring(4,6),16)+")"},clamp:function(t,e,n){return t<e?e:t>n?n:t},isElectron:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)},canPlayOgg:function(){var t=document.createElement("audio");return!!t.canPlayType&&t.canPlayType("audio/ogg")},getRandomInt:function(t,e){return 1===arguments.length&&(e=arguments[0],t=1),Math.floor(Math.random()*(e-t+1))+t},downloadBlob:function(t,e){var n=(window.URL||window.webkitURL).createObjectURL(t),r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=n,i.download=e,i.dispatchEvent(r)},shallowCopyHash:function(t){var e={};for(var n in t)e[n]=t[n];return e},assign:function(t,e){if(!t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},bind:function(t,e){if("function"!=typeof t)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),r=t,i=function(){},o=function(){return r.apply(t instanceof i?t:e,n.concat(Array.prototype.slice.call(arguments)))};return t.prototype&&(i.prototype=t.prototype),o.prototype=new i,o},defineProperty:function(t,e){var n="_"+e;t.prototype[e]=function(t){return void 0!==t&&(this[n]=t),this[n]}}};t.exports=r},function(t,e,n){"use strict";var r=n(18);t.exports=r.object_base},function(t,e,n){"use strict";t.exports={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128}},function(t,e,n){"use strict";var r=n(2),i=n(0),o={0:r.BUTTON_Z,1:r.BUTTON_X,2:r.BUTTON_SPACE,3:r.BUTTON_SHIFT},s=function(){this._current_keyflag=0,this._before_keyflag=0,this._key_bit_code_to_down_time={},this._button_id_to_key_bit_code=i.shallowCopyHash(o),this._is_left_clicked=!1,this._is_right_clicked=!1,this._before_is_left_clicked=!1,this._before_is_right_clicked=!1,this._mouse_change_x=0,this._mouse_change_y=0,this._mouse_x=0,this._mouse_y=0,this._mouse_scroll=0,this._touch_infos={},this._before_is_touched_map={},this._is_touched_map={},this._touch_ids=[],this._click_position_width_ratio=1,this._click_position_height_ratio=1,this._is_gamepad_usable=!1};s.prototype.init=function(){this._current_keyflag=0,this._before_keyflag=0,this._initPressedKeyTime(),this._button_id_to_key_bit_code=i.shallowCopyHash(o),this._is_left_clicked=!1,this._is_right_clicked=!1,this._before_is_left_clicked=!1,this._before_is_right_clicked=!1,this._mouse_change_x=0,this._mouse_change_y=0,this._mouse_x=0,this._mouse_y=0,this._mouse_scroll=0,this._touch_infos={},this._before_is_touched_map={},this._is_touched_map={},this._touch_ids=[],this._click_position_width_ratio=1,this._click_position_height_ratio=1},s.prototype.beforeRun=function(){this._handleGamePad(),this._setPressedKeyTime()},s.prototype.afterRun=function(){for(var t in this._before_keyflag=this._current_keyflag,this._before_is_left_clicked=this._is_left_clicked,this._before_is_right_clicked=this._is_right_clicked,this._mouse_scroll=0,this._mouse_change_x=0,this._mouse_change_y=0,this._before_is_touched_map={},this._touch_infos){var e=this._touch_infos[t];e.change_x=0,e.change_y=0,t in this._is_touched_map&&(this._before_is_touched_map[t]=!0)}},s.prototype.setupEvents=function(t){var e=this;window.onkeydown=function(t){e._handleKeyDown(t)},window.onkeyup=function(t){e._handleKeyUp(t)},t.onmousedown=function(t){e._handleMouseDown(t)},t.onmouseup=function(t){e._handleMouseUp(t)},t.onmousemove=function(t){e._handleMouseMove(t)},t.ontouchstart=function(t){e._handleTouchDown(t)},t.ontouchend=function(t){e._handleTouchUp(t)},t.ontouchmove=function(t){e._handleTouchMove(t)};var n=window.navi&&/Firefox/i.test(window.navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener&&t.addEventListener(n,function(t){var n=window.event||t;e._handleMouseWheel(n)},!1),t.oncontextmenu=function(){return!1},window.Gamepad&&window.navigator&&window.navigator.getGamepads&&(e._is_gamepad_usable=!0)},s.prototype.scaleClickPosition=function(t,e){this._click_position_width_ratio=t,this._click_position_height_ratio=e},t.exports=s},function(t,e,n){"use strict";var r=n(1),i=function(t,e){r.apply(this,arguments),e=e||{},this._default_property={x:e.x||0,y:e.y||0,children:e.children||[]},this._event_to_callback={beforedraw:null,click:null,draw:null,touch:null},this.objects=this._default_property.children,this._show_call_count=0,this._is_touched=!1};n(0).inherit(i,r),i.prototype.init=function(){this.objects=this._default_property.children,r.prototype.init.apply(this,arguments),this._show_call_count=0,this._is_touched=!1,this.x(this._default_property.x),this.y(this._default_property.y),this.show()},i.prototype.beforeDraw=function(){var t,e;if(r.prototype.beforeDraw.apply(this,arguments),this.isEventSet("beforedraw")&&this._callEvent("beforedraw"),this.isEventSet("click")&&this.core.input_manager.isLeftClickPush()&&(t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY(),this.checkCollisionWithPosition(t,e)&&this._callEvent("click")),this.isEventSet("touch")){var n=this.core.input_manager.getTouch(0);t=n.x(),e=n.y(),n.isTap()?this._is_touched=!0:n.isTouchRelease()&&(this.checkCollisionWithPosition(t,e)&&this._callEvent("touch"),this._is_touched=!1)}},i.prototype.draw=function(){this.isShow()&&(r.prototype.draw.apply(this,arguments),this.isEventSet("draw")&&this._callEvent("draw"))},i.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},i.prototype.removeEvent=function(t){return this._event_to_callback[t]=null,this},i.prototype.isEventSet=function(t){return!!this._event_to_callback[t]},i.prototype.isShow=function(){return this._show_call_count>0},i.prototype.collisionWidth=function(){return this.width()},i.prototype.collisionHeight=function(){return this.height()},i.prototype.show=function(){this._show_call_count=1},i.prototype.hide=function(){this._show_call_count=0},i.prototype._callEvent=function(t){this._event_to_callback[t].apply(this)},t.exports=i},function(t,e,n){"use strict";var r=n(1),i=n(0),o=function(t){this.core=t,this.parent=null,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this.scenes={},this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null,this._background_color=null,this.ui=new s(this),this.addObject(this.ui)};o.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this._x=0,this._y=0,this.frame_count=0,this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null;for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].init()},o.prototype.beforeDraw=function(){this._wait_to_start_bgm_name&&this.frame_count-this._wait_to_start_bgm_start_frame_count>=this._wait_to_start_bgm_duration&&(this.core.audio_loader.playBGM(this._wait_to_start_bgm_name),this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null),this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw(),this.frame_count++},o.prototype.draw=function(){this._drawBackground();for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},o.prototype._drawBackground=function(){var t=this.core.ctx;this._background_color&&(t.save(),t.fillStyle=this._background_color,t.fillRect(0,0,this.width,this.height),t.restore())},o.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},o.prototype.addObject=function(t){this.objects.push(t)},o.prototype.addObjects=function(t){this.objects=this.objects.concat(t)},o.prototype.removeAllObject=function(){this.objects=[]},o.prototype.removeObject=function(t){for(var e=0,n=this.objects.length;e<n;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},o.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},o.prototype.resetParent=function(){this.parent=null},o.prototype.currentSubScene=function(){if(null!==this.current_scene)return this.scenes[this.current_scene]},o.prototype.getSubScene=function(t){return this.scenes[t]},o.prototype.addSubScene=function(t,e){e.setParent(this),this.scenes[t]=e},o.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t,this._is_reserved_next_scene_init=!0,this.current_scene||this.changeNextSubSceneIfReserved()},o.prototype.returnSubScene=function(t){this._reserved_next_scene=[t],this._is_reserved_next_scene_init=!1},o.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene(),e=this._reserved_next_scene;this._reserved_next_scene=null,this._is_reserved_next_scene_init&&t.init.apply(t,e)}},o.prototype.setWaitToStartBGM=function(t,e){e||(e=0),this._wait_to_start_bgm_name=t,this._wait_to_start_bgm_duration=e,this._wait_to_start_bgm_start_frame_count=this.frame_count},o.prototype.x=function(t){return void 0!==t&&(this._x=t),this._x},o.prototype.y=function(t){return void 0!==t&&(this._y=t),this._y},o.prototype.root=function(){return this.parent?this.parent.root():this},o.prototype.setBackgroundColor=function(t){this._background_color=t},o.prototype.setFadeIn=function(t,e){return console.error("scene's setFadeIn method is deprecated."),this.core.scene_manager.setFadeIn.apply(this.core.scene_manager,arguments)},o.prototype.isInFadeIn=function(){return console.error("scene's isInFadeIn method is deprecated."),this.core.scene_manager.isInFadeIn.apply(this.core.scene_manager,arguments)},o.prototype.setFadeOut=function(t,e){return console.error("scene's setFadeOut method is deprecated."),this.core.scene_manager.setFadeOut.apply(this.core.scene_manager,arguments)},o.prototype.startFadeOut=function(){return console.error("scene's startFadeOut method is deprecated."),this.core.scene_manager.startFadeOut.apply(this.core.scene_manager,arguments)},o.prototype.isInFadeOut=function(){return console.error("scene's isInFadeOut method is deprecated."),this.core.scene_manager.isInFadeOut.apply(this.core.scene_manager,arguments)},o.prototype.isSetFadeOut=function(){return console.error("scene's isSetFadeOut method is deprecated."),this.core.scene_manager.isSetFadeOut.apply(this.core.scene_manager,arguments)};var s=function(t){r.apply(this,arguments)};i.inherit(s,r),t.exports=o},function(t,e,n){"use strict";var r=function(){this._name_to_class={}};r.prototype.addClass=function(t,e){if(void 0!==this[t])throw new Error(t+" is reserved word.");this._name_to_class[t]=e},r.prototype.initialLoad=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]||(this[t]=e.load())}},r.prototype.load=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]=e.load()}},r.prototype.save=function(){for(var t in this._name_to_class)this[t].save()},r.prototype.reload=function(){for(var t in this._name_to_class)this[t].reload()},r.prototype.del=function(){for(var t in this._name_to_class)this[t].del()},t.exports=r},function(t,e,n){"use strict";var r=n(18);t.exports=r.object_point},function(t,e,n){"use strict";var r=n(0),i=function(t){t||(t={}),this._data=t};i.KEY=function(){throw new Error("KEY method must be overridden.")},i.localFileDirectory=function(){return"save"},i.prototype.set=function(t,e){this._data[t]=e},i.prototype.get=function(t){return this._data[t]},i.prototype.exists=function(t){return t in this._data},i.prototype.remove=function(t){return delete this._data[t]},i.prototype.isEmpty=function(){return 0===Object.keys(this._data).length},i.prototype.toHash=function(){return r.shallowCopyHash(this._data)},i.isLocalMode=function(){return!!r.isElectron()},i.prototype.save=function(){this.constructor.isLocalMode()?this._saveToLocalFile():this._saveToWebStorage()},i.prototype._saveToLocalFile=function(){var t=this.constructor,e=window.require("fs"),n=window.require("path"),r=JSON.stringify(this._data),i=t._localFileDirectoryPath(),o=n.join(i,t._localFileName(t.KEY()));e.existsSync(i)||e.mkdirSync(i),e.writeFileSync(o,r)},i._localFileDirectoryPath=function(){var t=window.require("path"),e=window.require("electron").remote.app,n=e.getPath("appData"),r=e.getName();return t.join(n,r,this.localFileDirectory())},i._localFileName=function(t){return t+".json"},i._localFilePath=function(t){return window.require("path").join(this._localFileDirectoryPath(),this._localFileName(t))},i.prototype._saveToWebStorage=function(){var t=this.constructor.KEY(),e=JSON.stringify(this._data);try{window.localStorage.setItem(t,e)}catch(t){}},i.prototype.reload=function(){var t,e=this.constructor;t=e.isLocalMode()?e._loadFromLocalFile():e._loadFromWebStorage(),this._data=t||{}},i.load=function(){var t;return(t=this.isLocalMode()?this._loadFromLocalFile():this._loadFromWebStorage())?new this(t):new this},i._loadFromLocalFile=function(){var t=window.require("fs"),e=this._localFilePath(this.KEY());if(!t.existsSync(e))return null;var n=t.readFileSync(e,{encoding:"utf8"});return n?JSON.parse(n):null},i._loadFromWebStorage=function(){var t,e=this.KEY();try{t=window.localStorage.getItem(e)}catch(t){}return t?JSON.parse(t):null},i.prototype.del=function(){this.constructor.isLocalMode()?this._removeLocalFile():this._removeWebStorage(),this._data={}},i.prototype._removeLocalFile=function(){var t=this.constructor,e=window.require("fs"),n=t._localFilePath(t.KEY());e.existsSync(n)&&e.unlinkSync(n)},i.prototype._removeWebStorage=function(){var t=this.constructor.KEY();try{window.localStorage.removeItem(t)}catch(t){}},t.exports=i},function(t,e,n){"use strict";var r=n(5),i=function(t){r.apply(this,arguments),this.next_scene_name=null};n(0).inherit(i,r),i.prototype.init=function(t,e){r.prototype.init.apply(this,arguments);var n=t.images||[],i=t.sounds||[],o=t.bgms||[],s=t.fonts||[];for(var a in this.next_scene_name=e,n){var u=n[a];"string"==typeof u?this.core.image_loader.loadImage(a,u):this.core.image_loader.loadImage(a,u.path,u.scale_width,u.scale_height)}for(var c in i){var h=i[c];this.core.audio_loader.loadSound(c,h.path,h.volume)}for(var f in o){var _=o[f],l="volume"in _?_.volume:1;this.core.audio_loader.loadBGM(f,_.path,l,_.loopStart,_.loopEnd)}for(var d in s){var p=s[d];this.core.font_loader.loadFont(d,p.path,p.format)}},i.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.isAllLoaded()&&this.notifyAllLoaded()},i.prototype.progress=function(){return(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3},i.prototype.draw=function(){r.prototype.draw.apply(this,arguments)},i.prototype.notifyAllLoaded=function(){this.next_scene_name&&this.core.scene_manager.changeScene(this.next_scene_name)},t.exports=i},function(t,e,n){"use strict";var r=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};r.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},r.prototype.loadImage=function(t,e,n,r){var i=this;i.loading_image_num++;var o=new Image;o.src=e,o.onload=function(){i.images[t]=i._generateImageCanvas(t,n,r),i.loaded_image_num++},this.images[t]=o},r.prototype._generateImageCanvas=function(t,e,n){e=void 0===e?1:e,n=void 0===n?1:n;var r=this.getImage(t),i=r.width*e,o=r.height*n,s=document.createElement("canvas");return s.width=i,s.height=o,s.getContext("2d").drawImage(r,0,0,i,o),s},r.prototype.isAllLoaded=function(){return this.loaded_image_num===this.loading_image_num},r.prototype.isLoaded=function(t){return t in this.images},r.prototype.getImage=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t]},r.prototype.progress=function(){return 0===this.loading_image_num?1:this.loaded_image_num/this.loading_image_num},t.exports=r},function(t,e,n){"use strict";var r=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this.audio_context=null,window&&window.AudioContext&&(this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode),this._audio_source_map={}};r.prototype.init=function(){this.stopAllBGM(),this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this._audio_source_map={}},r.prototype.loadSound=function(t,e,n){if(window&&window.Audio){var r=this;r.loading_audio_num++,void 0===n&&(n=1);var i=new window.Audio(e);i.volume=n,i.addEventListener("canplay",function(){r.loaded_audio_num++}),i.addEventListener("error",function(){throw new Error("Audio Element error. "+e+", code: "+i.error.code+", message: "+i.error.message)}),i.load(),r.sounds[t]={audio:i}}},r.prototype.loadBGM=function(t,e,n,r,i){if(this.audio_context){var o=this;o.loading_audio_num++,void 0===n&&(n=1);var s=function(e){o.loaded_audio_num++,o.bgms[t]={audio:e,volume:n,loopStart:r,loopEnd:i}},a=function(t){throw t instanceof Error?new Error(t.message):t},u=new XMLHttpRequest;u.onload=function(){if(200===u.status){var t=u.response;o.audio_context.decodeAudioData(t,s,a)}},u.open("GET",e,!0),u.responseType="arraybuffer",u.send(null)}},r.prototype.isAllLoaded=function(){return this.loaded_audio_num===this.loading_audio_num},r.prototype.playSound=function(t){if(this.audio_context){if(!(t in this.sounds))throw new Error("Can't find sound '"+t+"'.");this._reserved_play_sound_name_map[t]=!0}},r.prototype.executePlaySound=function(){for(var t in this._reserved_play_sound_name_map)this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),delete this._reserved_play_sound_name_map[t]},r.prototype.playSoundByDataURL=function(t,e){if(window&&window.Audio){void 0===e&&(e=1);var n=new window.Audio;n.volume=e,n.src=t,n.addEventListener("canplay",function(){n.play()}),n.addEventListener("error",function(){throw new Error("Audio Element error. code: "+n.error.code+", message: "+n.error.message)}),n.load()}},r.prototype.playBGM=function(t){this.stopAllBGM(),this.addBGM(t)},r.prototype.addBGM=function(t){this.audio_context&&(this.isPlayingBGM(t)&&this.stopBGM(t),this._audio_source_map[t]=this._createSourceNodeAndGainNode(t),this._audio_source_map[t].source_node.start(0))},r.prototype.changeBGM=function(t){this.isPlayingBGM(t)||this.playBGM(t)},r.prototype.stopAllBGM=function(){for(var t in this._audio_source_map)this.stopBGM(t)},r.prototype.stopBGMWithout=function(t){for(var e in this._audio_source_map)e!==t&&this.stopBGM(e)},r.prototype.stopBGM=function(t){if(void 0===t)return this.stopAllBGM();this.fadeOutBGM(.1,t),t in this._audio_source_map&&delete this._audio_source_map[t]},r.prototype.isPlayingBGM=function(t){return void 0===t?!!Object.keys(this._audio_source_map).length:t in this._audio_source_map},r.prototype.fadeOutAllBGM=function(t){for(var e in this._audio_source_map)this.fadeOutBGM(t,e)},r.prototype.fadeOutBGM=function(t,e){if(this.audio_context){if(void 0===e)return this.fadeOutAllBGM(t);var n=this._audio_source_map[e];if(n){var r=n.gain_node.gain,i=this.audio_context.currentTime;r.cancelScheduledValues(i),r.setValueAtTime(r.value,i);var o=i+t;r.linearRampToValueAtTime(0,o)}}},r.prototype.muteAllBGM=function(){for(var t in this._audio_source_map)this.muteBGM(t)},r.prototype.muteBGM=function(t){if(this.audio_context){if(void 0===t)return this.muteAllBGM();var e=this._audio_source_map[t];if(e)e.gain_node.gain.setValueAtTime(0,this.audio_context.currentTime)}},r.prototype.unMuteAllBGM=function(){for(var t in this._audio_source_map)this.unMuteBGM(t)},r.prototype.unMuteBGM=function(t){if(this.audio_context){if(void 0===t)return this.unMuteAllBGM();var e=this._audio_source_map[t];if(e){var n=e.gain_node,r=this.bgms[t];n.gain.setValueAtTime(r.volume,this.audio_context.currentTime)}}},r.prototype.unMuteWithFadeInAllBGM=function(t){for(var e in this._audio_source_map)this.unMuteWithFadeInBGM(t,e)},r.prototype.unMuteWithFadeInBGM=function(t,e){if(this.audio_context){if(void 0===e)return this.unMuteWithFadeInAllBGM(t);var n=this._audio_source_map[e];if(n){var r=this.bgms[e],i=n.gain_node.gain,o=this.audio_context.currentTime;i.setValueAtTime(i.value,o);var s=o+t;i.linearRampToValueAtTime(r.volume,s)}}},r.prototype._createSourceNodeAndGainNode=function(t){if(this.audio_context){if(!(t in this.bgms))throw new Error("Can't find bgm name: "+t);var e=this.bgms[t],n=this.audio_context.createBufferSource();n.buffer=e.audio,("loopStart"in e||"loopEnd"in e)&&(n.loop=!0),e.loopStart&&(n.loopStart=e.loopStart),e.loopEnd&&(n.loopEnd=e.loopEnd);var r=this.audio_context.createGain();return r.gain.setValueAtTime(e.volume,this.audio_context.currentTime),n.connect(r),r.connect(this.audio_context.destination),n.start=n.start||n.noteOn,n.stop=n.stop||n.noteOff,{source_node:n,gain_node:r}}},r.prototype.progress=function(){return 0===this.loading_audio_num?1:this.loaded_audio_num/this.loading_audio_num},t.exports=r},function(t,e,n){"use strict";var r=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={},this._hiddenCanvas=null};r.prototype.init=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={}},r.prototype.isAllLoaded=function(){for(var t in this._fontStatues)if(!this.isLoaded(t))return!1;return!0},r.prototype.progress=function(){var t=0,e=0;for(var n in this._fontStatues)t++,this.isLoaded(n)&&e++;return 0===t?1:e/t},r.prototype.setupEvents=function(){var t=this;t.canUseCssFontLoading()?window.document.fonts.ready.then(function(e){t._isLoadedDone=!0,t._loadedFonts=e}).catch(function(t){throw new Error("Can't load font.")}):t.canUseCssFont()?window.document.fonts.addEventListener("loadingdone",function(){t._isLoadedDone=!0,t._loadedFonts=null}):(t._isLoadedDone=!0,t._loadedFonts=null)};var i=window.document&&window.document.fonts&&window.document.fonts.ready&&document.fonts.ready.then;r.prototype.canUseCssFontLoading=function(){return i},r.prototype.canUseCssFont=function(){return window.document&&window.document.fonts&&!this.isSafari10()},r.prototype.isSafari10=function(){return navigator.userAgent.toLowerCase().indexOf("safari")&&navigator.userAgent.toLowerCase().indexOf("version/10.0")},r.prototype.isLoaded=function(t){if(!(t in this._fontStatues))return!1;var e=this._fontStatues[t];if(e.is_loaded)return!0;var n=this.checkFontLoaded(t);return n&&(e.is_loaded=!0),n},r.prototype.checkFontLoaded=function(t){if(this.canUseCssFontLoading())return window.document.fonts.check('10px "'+t+'"');this._hiddenCanvas||(this._hiddenCanvas=window.document.createElement("canvas"));var e,n=this._hiddenCanvas.getContext("2d"),r="abcdefghijklmnopqrstuvwxyz";return n.font="40px "+t+", sans-serif",e=n.measureText(r).width,n.font="40px sans-serif",e!==n.measureText(r).width},r.prototype.loadFont=function(t,e,n){return!!window.document&&(this._fontStatues[t]={is_loaded:!1},this._createFontFaceStyle(t,e,n),this._createFontLoadingDOM(t),!0)},r.prototype._createFontFaceStyle=function(t,e,n){var r,i=window.document.getElementsByTagName("head");if(!i)throw new Error("Fontloader class needs head tag in html file.");r=void 0!==n?'@font-face { font-family: "'+t+'"; src: url("'+e+'") format("'+n+'"); }':'@font-face { font-family: "'+t+'"; src: url("'+e+'"); }';var o=window.document.createElement("style");o.type="text/css",i.item(0).appendChild(o),o.sheet.insertRule(r,0)},r.prototype._createFontLoadingDOM=function(t){var e=window.document.createElement("div"),n=window.document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(n),window.document.body.appendChild(e)},t.exports=r},function(t,e,n){"use strict";var r=function(t,e,n,r,i){if(!t)throw new Error("arguments 1 must be WebGLRenderingContext instance");this.gl=t;var o,s=this.createShader(t,t.VERTEX_SHADER,e),a=this.createShader(t,t.FRAGMENT_SHADER,n),u=this.createShaderProgram(t,s,a),c={};for(o=0;o<r.length;o++)c[r[o]]=t.getAttribLocation(u,r[o]);var h={};for(o=0;o<i.length;o++)h[i[o]]=t.getUniformLocation(u,i[o]);this.shader_program=u,this.attribute_locations=c,this.uniform_locations=h};r.prototype.createShader=function(t,e,n){if(e!==t.VERTEX_SHADER&&e!==t.FRAGMENT_SHADER)throw new Error("type must be vertex or fragment");var r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw(e===t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(r);return r},r.prototype.createShaderProgram=function(t,e,n){var r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error("Could not initialize shaders:\n\n"+t.getProgramInfoLog(r));return r},t.exports=r},function(t,e,n){"use strict";var r=n(0),i=n(44),o=function(t,e){this.core=t,e=e||{},this._typography_speed="typography_speed"in e?e.typography_speed:10,this._criteria_function_map="criteria"in e?e.criteria:{},this._event_to_callback={printend:function(){}},this._timeoutID=null,this._script=null,this._progress=null,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]};r.inherit(o,i),o.prototype.init=function(t){if(!t)throw new Error("set script arguments to use scenario_manager class");this._timeoutID&&this._stopPrintLetter(),this._script=t.slice(),this._progress=-1,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]},o.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},o.prototype.removeEvent=function(t){return this._event_to_callback[t]=function(){},this},o.prototype.start=function(t){if(!this._script)throw new Error("start method must be called after instance was initialized.");this.isEnd()||(this._progress=t||0,this._chooseNextSerifScript(),this._setupCurrentSerifScript())},o.prototype.next=function(t){return t=t||0,!this.isEnd()&&(this._progress++,this._chooseNextSerifScript(t),this._setupCurrentSerifScript(),!0)},o.prototype._chooseNextSerifScript=function(t){var e,n=this._script[this._progress],r=n.type||"serif";if("serif"===r);else if("junction_serif"===r){if(!(e=n.serifs[t]))throw new Error("chosen junction index '"+t+"' does not exists in next serifs array");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e))}else{if("criteria_serif"!==r)throw new Error("Unknown serif script type: "+r);var i=n.criteria,o=n.arguments;if(t=this._execCriteriaFunction(i,o),!(e=n.serifs[t]))throw new Error("choisen criteria index '"+t+"' does not exists");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e)),this._chooseNextSerifScript()}},o.prototype._execCriteriaFunction=function(t,e){var n=this._criteria_function_map[t];if(!n)throw new Error(t+" criteria does not exists");return n.apply({},[this.core].concat(e))},o.prototype.isStart=function(){return this._progress>-1},o.prototype.isEnd=function(){return this._progress===this._script.length-1},o.prototype.isPrintLetterEnd=function(){var t=this._current_message_letter_list.length;return this._letter_idx>=t},o.prototype._setupCurrentSerifScript=function(){var t=this._script[this._progress];this._setupChara(t),this._setupBackground(t),this._setupJunction(t),this._setupOption(t),this._saveSerifPlayed(t),"string"==typeof t.serif?this._setupSerif(t):this.isEnd()||this.next()},o.prototype._setupChara=function(t){var e=t.pos,n=t.chara,r=t.exp;e||(e=0),this._current_talking_pos=e,this._pos_to_chara_id_map[this._current_talking_pos]=n,this._pos_to_exp_id_map[this._current_talking_pos]=r},o.prototype._setupBackground=function(t){var e=t.background;this._is_background_changed=!1,e&&this._current_bg_image_name!==e&&(this._is_background_changed=!0,this._current_bg_image_name=e)},o.prototype._setupJunction=function(t){var e=t.junction;this._current_junction_list=e||[]},o.prototype._setupOption=function(t){this._current_option=t.option||{}},o.prototype._saveSerifPlayed=function(t){var e=t.id;if(t.save){if(void 0===e)throw new Error("script save property needs id property");this.core.save_manager.scenario.incrementPlayedCount(e)}},o.prototype._setupSerif=function(t){var e=t.serif;this._stopPrintLetter(),this._current_message_letter_list=e.split("");var n=e.split("\n");this._current_message_max_length_letters=0;for(var r=0,i=n.length;r<i;r++)this._current_message_max_length_letters<n[r].length&&(this._current_message_max_length_letters=n[r].length);this._current_message_sentenses_num=n.length,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[],this._startPrintLetter()},o.prototype._startPrintLetter=function(){this._printLetter(),this.isPrintLetterEnd()?this._timeoutID=null:this._timeoutID=setTimeout(r.bind(this._startPrintLetter,this),this._typography_speed)},o.prototype._stopPrintLetter=function(){null!==this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},o.prototype._printLetter=function(){if(!this.isPrintLetterEnd()){var t=this._current_message_letter_list[this._letter_idx++];this._current_printed_sentences[this._sentences_line_num]||(this._current_printed_sentences[this._sentences_line_num]=""),"\n"===t?this._sentences_line_num++:this._current_printed_sentences[this._sentences_line_num]+=t,this.isPrintLetterEnd()&&this._event_to_callback.printend()}},o.prototype.resumePrintLetter=function(){this._startPrintLetter()},o.prototype.pausePrintLetter=function(){this._stopPrintLetter()},o.prototype.getCurrentPrintedSentences=function(){return this._current_printed_sentences},o.prototype.getCurrentSentenceNum=function(){return this._current_message_sentenses_num},o.prototype.getCurrentMaxLengthLetters=function(){return this._current_message_max_length_letters},o.prototype.isBackgroundChanged=function(){return this._is_background_changed},o.prototype.getCurrentBackgroundImageName=function(){return this._current_bg_image_name},o.prototype.getCurrentOption=function(){return this._current_option},o.prototype.getCurrentCharaNameByPosition=function(t){return t=t||0,this._pos_to_chara_id_map[t]},o.prototype.getCurrentCharaExpressionByPosition=function(t){return t=t||0,this._pos_to_exp_id_map[t]},o.prototype.isCurrentTalkingByPosition=function(t){return this._current_talking_pos===t},o.prototype.isCurrentSerifExistsJunction=function(){return this._current_junction_list.length>0},o.prototype.getCurrentJunctionList=function(){return this._current_junction_list},t.exports=o},function(t,e,n){"use strict";var r=n(24),i=function(t,e){r.apply(this,arguments),this.Class=e};n(0).inherit(i,r),i.prototype.init=function(){r.prototype.init.apply(this,arguments)},i.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},i.prototype.draw=function(){r.prototype.draw.apply(this,arguments)},i.prototype.afterDraw=function(){r.prototype.afterDraw.apply(this,arguments)},i.prototype.create=function(t){var e=new this.Class(this.scene);return e.init.apply(e,arguments),this.addObject(e),e},t.exports=i},function(t,e,n){"use strict";t.exports=n(31)},function(t,e,n){"use strict";var r=n(32),i=n(0),o=n(34),s=n(35),a=n(19),u=n(6),c=n(36),h=n(10),f=n(11),_=n(12),l=n(41),d=n(13),p=n(42),m=n(43),y=function(t,e){e||(e={}),this.canvas_dom=t,this.ctx=null,this.gl=null,e.webgl?(this.gl=this.createWebGLContext(this.canvas_dom),this.sprite_3d_shader=new d(this.gl,p,m,["aTextureCoordinates","aVertexPosition","aColor"],["uMVMatrix","uPMatrix","uSampler"])):this.ctx=this.canvas_dom.getContext("2d"),this.debug_manager=new o(this),this.scene_manager=new s(this),this.time_manager=new a,this.save_manager=new u,this.input_manager=new c,this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this._cursor_image_name=null,this._default_cursor_image_name=null,this._is_resize_fired=!1,this.frame_count=0,this.request_id=null,this.image_loader=new h,this.audio_loader=new f,this.font_loader=new _,this.save_manager.addClass("scenario",l)};y.prototype.init=function(){this._is_resize_fired=!1,this.frame_count=0,this.request_id=null,this.debug_manager.init(),this.scene_manager.init(),this.time_manager.init(),this.input_manager.init(),this.image_loader.init(),this.audio_loader.init(),this.font_loader.init(),this.save_manager.initialLoad()},y.prototype.reload=function(){this.init()},y.prototype.isRunning=function(){return!!this.request_id},y.prototype.startRun=function(){this.isRunning()||this.run()},y.prototype.stopRun=function(){this.isRunning()&&(cancelAnimationFrame(this.request_id),this.request_id=null)},y.prototype.run=function(){this.debug_manager.beforeRun(),this.scene_manager.beforeRun(),this.input_manager.beforeRun(),this.time_manager.executeEvents(),this.audio_loader.executePlaySound(),this.changeDefaultCursorImage();var t=this.scene_manager.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw(),this.scene_manager.drawTransition(),this._renderCursorImage()),this.frame_count++,this.debug_manager.afterRun(),this.input_manager.afterRun(),this._is_resize_fired&&this._fullsize(),this.request_id=requestAnimationFrame(i.bind(this.run,this))},y.prototype.clearCanvas=function(){this.is2D()?this.canvas_dom.width=this.canvas_dom.width:this.is3D()&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT))},y.prototype.is2D=function(){return!!this.ctx},y.prototype.is3D=function(){return!!this.gl},y.prototype.isKeyDown=function(t){return this.input_manager.isKeyDown(t)},y.prototype.isKeyPush=function(t){return this.input_manager.isKeyPush(t)},y.prototype.getKeyDownTime=function(t){return this.input_manager.getKeyDownTime(t)},y.prototype.isLeftClickDown=function(){return this.input_manager.isLeftClickDown()},y.prototype.isLeftClickPush=function(){return this.input_manager.isLeftClickPush()},y.prototype.isRightClickDown=function(){return this.input_manager.isRightClickDown()},y.prototype.isRightClickPush=function(){return this.input_manager.isRightClickPush()},y.prototype.mousePositionX=function(){return this.input_manager.mousePositionX()},y.prototype.mousePositionY=function(){return this.input_manager.mousePositionX()},y.prototype.mouseMoveX=function(){return this.input_manager.mouseMoveX()},y.prototype.mouseMoveY=function(){return this.input_manager.mouseMoveY()},y.prototype.mouseScroll=function(){return this.input_manager.mouseScroll()},y.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},y.prototype.isAllLoaded=function(){return!!(this.image_loader.isAllLoaded()&&this.audio_loader.isAllLoaded()&&this.font_loader.isAllLoaded())},y.prototype.setupEvents=function(){window&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},this._setupError(),this.font_loader.setupEvents(),this.input_manager.setupEvents(this.canvas_dom))},y.prototype._setupError=function(){var t=this;window.onerror=function(e,n,r,i,o){t.showError(e,n,r,i,o)}},y.prototype.fullsize=function(){var t=this;window.onresize=function(e){t._is_resize_fired=!0},this._fullsize()},y.prototype._fullsize=function(){var t,e,n,r,i=window.innerWidth/window.innerHeight,o=this.width/this.height;o>=i?(n=window.innerWidth,r=window.innerWidth/o,e=(window.innerHeight-r)/2,t=0):(r=window.innerHeight,n=window.innerHeight*o,e=0,t=(window.innerWidth-n)/2);var s=this.width/n,a=this.height/r,u=this.canvas_dom;u.style.left=t+"px",u.style.top=e+"px",u.style.width=n+"px",u.style.height=r+"px",this.input_manager.scaleClickPosition(s,a)},y.prototype.showError=function(t,e,n,r,i){if(this.clearCanvas(),this.is2D()){var o=this.ctx,s=24,a=80;o.save(),o.fillStyle="black",o.fillRect(0,0,this.width,this.height),o.restore(),o.save(),o.fillStyle="red",o.font="48px 'sans-serif'",o.fillText("Error",s,a),a+=48,o.fillStyle="white",o.font="24px 'sans-serif'",o.fillText(t,s,a),a+=29,o.fillText("Time: "+(new Date).toString(),s,a),a+=29,o.fillText("File: "+e,s,a),a+=29,o.fillText("Line: "+n+", Column:"+r,s,a),a+=29,o.fillText("Stack Trace: ",s,a),a+=29,s+=29;for(var u=i.stack.split("\n"),c=0,h=u.length;c<h;c++){var f=u[c];o.fillText(f,s,a),a+=29}o.restore()}else this.is3D()&&window.alert(t+"\n"+n+":"+r)},y.prototype.createWebGLContext=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=r.makeDebugContext(e)}catch(t){throw t}if(!e)throw new Error("Could not initialize WebGL");return e},y.prototype.enableCursorImage=function(t){this.canvas_dom.style.cursor="none",this._default_cursor_image_name=t},y.prototype.isUsingCursorImage=function(){return!!this._default_cursor_image_name},y.prototype.changeCursorImage=function(t){this._cursor_image_name=t},y.prototype.disableCursorImage=function(t){this.isUsingCursorImage()&&(this.canvas_dom.style.cursor="auto",this._cursor_image_name=null,this._default_cursor_image_name=null)},y.prototype.changeDefaultCursorImage=function(){this.isUsingCursorImage()&&(this._cursor_image_name=this._default_cursor_image_name)},y.prototype._renderCursorImage=function(){if(this.isUsingCursorImage()&&this.image_loader.isLoaded(this._cursor_image_name)){var t=this.ctx;if(t){t.save();var e=this.image_loader.getImage(this._cursor_image_name),n=this.input_manager.mousePositionX(),r=this.input_manager.mousePositionY(),i=this.image_loader.getScaleWidth(this._cursor_image_name),o=this.image_loader.getScaleHeight(this._cursor_image_name);t.translate(n,r),t.drawImage(e,0,0,e.width*i,e.height*o),t.restore()}}},y.prototype.setTimeout=function(t,e){console.error("core's setTimeout method is deprecated."),this.time_manager.setTimeout(t,e)},y.prototype.currentScene=function(){return console.error("core's currentScene method is deprecated."),this.scene_manager.currentScene.apply(this.scene_manager,arguments)},y.prototype.addScene=function(t,e){return console.error("core's addScene method is deprecated."),this.scene_manager.addScene.apply(this.scene_manager,arguments)},y.prototype.changeScene=function(t,e){return console.error("core's changeScene method is deprecated."),this.scene_manager.changeScene.apply(this.scene_manager,arguments)},y.prototype.changeNextSceneIfReserved=function(){return console.error("core's changeNextSceneIfReserved method is deprecated."),this.scene_manager.changeNextSceneIfReserved.apply(this.scene_manager,arguments)},y.prototype.changeSceneWithLoading=function(t,e){return console.error("core's changeSceneWithLoading method is deprecated."),this.scene_manager.changeSceneWithLoading.apply(this.scene_manager,arguments)},t.exports=y},function(t,e,n){"use strict";var r=n(0),i=0,o=function(t){this.scene=t,this.core=t.core,this.parent=null,this.id=++i,this.frame_count=0,this._x=0,this._y=0,this._auto_disable_times_map={},this._velocity=null,this.resetVelocity(),this._previous_x=null,this._previous_y=null,this.objects=[]};r.defineProperty(o,"x"),r.defineProperty(o,"y"),o.prototype.init=function(){this.frame_count=0,this._auto_disable_times_map={},this.resetVelocity(),this._previous_x=null,this._previous_y=null;for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].init()},o.prototype.beforeDraw=function(){this.frame_count++,this._checkAutoDisableFlags();for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].beforeDraw();this.moveByVelocity(this._velocity)},o.prototype.draw=function(){this.core.debug_manager.isShowingCollisionArea()&&this._drawCollisionArea(this.core.debug_manager.collisionAreaColor());for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].draw()},o.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].afterDraw()},o.prototype.width=function(){return 0},o.prototype.height=function(){return 0},o.prototype.setPosition=function(t,e){this._x=t,this._y=e},o.prototype.root=function(){return this.parent?this.parent.root():this},o.prototype.globalCenterX=function(){return this.scene.x()+this.x()},o.prototype.globalCenterY=function(){return this.scene.y()+this.y()},o.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},o.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},o.prototype.globalUpY=function(){return this.scene.y()+this.y()-this.height()/2},o.prototype.globalDownY=function(){return this.scene.y()+this.y()+this.height()/2},o.prototype.addSubObject=function(t){t.setParent(this),this.objects.push(t)},o.prototype.addSubObjects=function(t){for(var e=0,n=t.length;e<n;e++){t[e].setParent(this)}this.objects=this.objects.concat(t)},o.prototype.removeSubObject=function(t){for(var e=0,n=this.objects.length;e<n;e++)if(this.objects[e].id===t.id){this.objects[e].resetParent(),this.objects.splice(e,1);break}},o.prototype.removeAllSubObject=function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].resetParent();this.objects=[]},o.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},o.prototype.resetParent=function(){this.parent=null},o.prototype.collisionWidth=function(t){return 0},o.prototype.collisionHeight=function(t){return 0},o.prototype.onCollision=function(t){},o.prototype.isCollision=function(t){return!0},o.prototype.checkCollisionWithObject=function(t){var e=t.intersect(this);return e&&(t.onCollision(this),this.onCollision(t)),e},o.prototype.checkCollisionWithObjects=function(t){for(var e=!1,n=0;n<t.length;n++){var r=t[n];this.checkCollisionByObject(r)&&(this.onCollision(r),r.onCollision(this),e=!0)}return e},o.prototype.checkCollisionWithPosition=function(t,e){var n=new s(this.scene);return n.init(),n.setPosition(t,e),this.checkCollisionWithObject(n)},o.prototype.intersect=function(t){return!(!this.isCollision(t)||!t.isCollision(this))&&(Math.abs(this.collisionX()-t.collisionX())<this.collisionWidth(t)/2+t.collisionWidth(this)/2&&Math.abs(this.collisionY()-t.collisionY())<this.collisionHeight(t)/2+t.collisionHeight(this)/2)},o.prototype.collisionX=function(){return this.x()},o.prototype.collisionY=function(){return this.y()},o.prototype.getCollisionLeftX=function(t){return this.collisionX()-this.collisionWidth(t)/2},o.prototype.getCollisionRightX=function(t){return this.collisionX()+this.collisionWidth(t)/2},o.prototype.getCollisionUpY=function(t){return this.collisionY()-this.collisionHeight(t)/2},o.prototype.getCollisionDownY=function(t){return this.collisionY()+this.collisionHeight(t)/2},o.prototype._drawCollisionArea=function(t){var e=new o(this.scene);if(this.isCollision(e)){t=t||"rgb( 255, 255, 255 )";var n=this.core.ctx;n.save(),n.fillStyle=t,n.globalAlpha=.4,n.translate(this.globalCenterX(),this.globalCenterY()),n.fillRect(-this.collisionWidth(e)/2,-this.collisionHeight(e)/2,this.collisionWidth(e),this.collisionHeight(e)),n.restore()}},o.prototype.checkCollision=function(t){return this.checkCollisionByObject(t)},o.prototype.checkCollisionByObject=function(t){return this.intersect(t)},o.prototype.setAutoDisableFlag=function(t,e){this[t]=!0,this._auto_disable_times_map[t]=this.frame_count+e},o.prototype._checkAutoDisableFlags=function(){for(var t in this._auto_disable_times_map)this._auto_disable_times_map[t]<this.frame_count&&(this[t]=!1,delete this._auto_disable_times_map[t])},o.prototype.moveByVelocity=function(t){if(0!==this._velocity.magnitude){var e=r.calcMoveXByVelocity(t),n=r.calcMoveYByVelocity(t);this._previous_x=this._x,this._previous_y=this._y,this._x+=e,this._y+=n}},o.prototype.setVelocity=function(t){this._velocity=t},o.prototype.resetVelocity=function(){this._velocity={magnitude:0,theta:0}},o.prototype.setVelocityMagnitude=function(t){this._velocity.magnitude=t},o.prototype.setVelocityTheta=function(t){this._velocity.theta=t},o.prototype.moveBack=function(){if(null!==this._previous_x||!this._previous_y){var t=this._x,e=this._y;this._x=this._previous_x,this._y=this._previous_y,this._previous_x=t,this._previous_y=e}},o.prototype.isOutOfStage=function(){return this.x()+100<0||this.y()+100<0||this.x()>this.scene.width+100||this.y()>this.scene.height+100};var s=function(t){o.apply(this,arguments)};r.inherit(s,o),s.prototype.collisionWidth=function(){return 1},s.prototype.collisionHeight=function(){return 1},s.prototype.width=function(){return 1},s.prototype.height=function(){return 1},t.exports={object_base:o,object_point:s}},function(t,e,n){"use strict";var r=0,i=function(){this.events={},this.frame_count=0};i.prototype.init=function(){this.events={},this.frame_count=0},i.prototype.setTimeout=function(t,e){var n=this.frame_count+e,i=++r;return this.events[n]||(this.events[n]={}),this.events[n][i]={callback:t},i},i.prototype.clearTimeout=function(t){for(var e in this.events){var n=this.events[e];if(t in n)return delete n[t],!0}return!1},i.prototype.executeEvents=function(){var t=this.frame_count,e=this.events[t];if(e){for(var n in e){e[n].callback()}delete this.events[t]}this.frame_count++},t.exports=i},function(t,e,n){"use strict";var r=n(5),i=function(t){r.apply(this,arguments),this.video=null,this.next_scene_name_and_args=null,this.is_playing=!1,this._height=null,this._width=null,this._top=null,this._left=null,this.is_mute=!1};n(0).inherit(i,r),i.prototype.init=function(t,e){r.prototype.init.apply(this,arguments);var n=this;n.is_playing=!1,n._height=null,n._width=null,n._top=null,n._left=null,n._callback=function(){},e&&(n._callback=e),this.isStopBGM()&&this.core.audio_loader.stopBGM();var i=document.createElement("video");i.src=t,i.controls=!1,i.preload="auto",i.oncanplaythrough=function(){n._calcDrawSizeAndPosition(),i.play(),n.is_playing=!0},this.is_mute&&(i.muted=!0),i.load(),n.video=i},i.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.is_playing&&this.video.ended&&this.notifyEnd()},i.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t&&(t.save(),t.fillStyle="black",t.fillRect(0,0,this.core.width,this.core.height),this.is_playing&&t.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this._left,this._top,this._width,this._height),t.restore())},i.prototype._calcDrawSizeAndPosition=function(){var t,e,n,r,i=this.width/this.height,o=this.video.videoWidth/this.video.videoHeight;o>=i?(n=this.width,r=this.width/o,e=(this.height-r)/2,t=0):(r=this.height,n=this.height*o,e=0,t=(this.width-n)/2),this._height=r,this._width=n,this._top=e,this._left=t},i.prototype.notifyEnd=function(){this.video=null,this.is_playing=!1,this._callback()},i.prototype.isStopBGM=function(){return!0},t.exports=i},function(t,e,n){"use strict";var r=n(1),i=n(0),o=function(t){r.apply(this,arguments),this.current_sprite_index=0};i.inherit(o,r),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()==0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},o.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var n=i.thetaToRadian(this._velocity.theta+this.rotateAdjust());e.rotate(n);var o=this.spriteWidth(),s=this.spriteHeight();o||(o=t.width),s||(s=t.height);var a=this.width(),u=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.globalAlpha=this.alpha(),e.drawImage(t,o*this.spriteIndexX(),s*this.spriteIndexY(),o,s,-a/2,-u/2,a,u),e.restore()}r.prototype.draw.apply(this,arguments)},o.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},o.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},o.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},o.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},o.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},o.prototype.isShow=function(){return!0},o.prototype.spriteAnimationSpan=function(){return 0},o.prototype.spriteIndices=function(){return[{x:0,y:0}]},o.prototype.spriteWidth=function(){return 0},o.prototype.spriteHeight=function(){return 0},o.prototype.rotateAdjust=function(){return 0},o.prototype.scale=function(){return 0},o.prototype.scaleWidth=function(){return 1},o.prototype.scaleHeight=function(){return 1},o.prototype.isReflect=function(){return!1},o.prototype.alpha=function(){return 1},t.exports=o},function(t,e,n){"use strict";var r=n(1),i=n(0),o=n(23).SPRITE3D,s=n(28),a=function(t){r.apply(this,arguments),this.current_sprite_index=0,this._z=0,this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[],this.vertices.length=o.V_SIZE,this.coordinates.length=o.C_SIZE,this.indices.length=o.I_SIZE,this.colors.length=o.A_SIZE;var e=this.core.gl;this.vBuffer=e.createBuffer(),this.cBuffer=e.createBuffer(),this.iBuffer=e.createBuffer(),this.aBuffer=e.createBuffer(),this.texture=null,this.mvMatrix=s.mat4.create(),this.pMatrix=s.mat4.create()};i.inherit(a,r),a.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0,this._initmvpMatrix(),this._initVertices(),this._initCoordinates(),this._initIndices(),this._initColors(),this._initTexture()},a.prototype._initmvpMatrix=function(){s.mat4.identity(this.mvMatrix),s.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},a.prototype._initVertices=function(){var t=this.spriteWidth()/2,e=this.spriteHeight()/2;this.vertices[0]=-t,this.vertices[1]=-e,this.vertices[2]=-1,this.vertices[3]=t,this.vertices[4]=-e,this.vertices[5]=-1,this.vertices[6]=t,this.vertices[7]=e,this.vertices[8]=-1,this.vertices[9]=-t,this.vertices[10]=e,this.vertices[11]=-1},a.prototype._initCoordinates=function(){var t=this.core.image_loader.getImage(this.spriteName()),e=this.spriteWidth()/t.width,n=this.spriteHeight()/t.height,r=e*this.spriteIndexX(),i=n*this.spriteIndexY(),o=r+e,s=i+n;this.coordinates[0]=r,this.coordinates[1]=s,this.coordinates[2]=o,this.coordinates[3]=s,this.coordinates[4]=o,this.coordinates[5]=i,this.coordinates[6]=r,this.coordinates[7]=i},a.prototype._initIndices=function(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3},a.prototype._initColors=function(){this.colors[0]=1,this.colors[1]=1,this.colors[2]=1,this.colors[3]=1,this.colors[4]=1,this.colors[5]=1,this.colors[6]=1,this.colors[7]=1,this.colors[8]=1,this.colors[9]=1,this.colors[10]=1,this.colors[11]=1,this.colors[12]=1,this.colors[13]=1,this.colors[14]=1,this.colors[15]=1},a.prototype._initTexture=function(){var t=this.core.gl,e=this.core.image_loader.getImage(this.spriteName()),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this.texture=n},a.prototype._setOrthographicProjection=function(){s.mat4.identity(this.pMatrix);s.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,.1,10)},a.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()==0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0)),this._initVertices(),this._initCoordinates(),this._translate()},a.prototype._translate=function(){for(var t=0;t<o.V_ITEM_NUM;t++)this.vertices[t*o.V_ITEM_SIZE+0]+=this.x(),this.vertices[t*o.V_ITEM_SIZE+1]-=this.y(),this.vertices[t*o.V_ITEM_SIZE+2]+=this.z()},a.prototype._rotate=function(){for(var t=this._getRadian(),e=0;e<o.V_ITEM_NUM;e++){var n=this.vertices[e*o.V_ITEM_SIZE+0],r=this.vertices[e*o.V_ITEM_SIZE+1];this.vertices[e*o.V_ITEM_SIZE+0]=n*Math.cos(t)-r*Math.sin(t),this.vertices[e*o.V_ITEM_SIZE+1]=n*Math.sin(t)+r*Math.cos(t)}},a.prototype._getRadian=function(){var t=this.velocity.theta;return i.thetaToRadian(t)},a.prototype.draw=function(){if(this.isShow()){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),o.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),o.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),o.A_ITEM_SIZE),this._setupTexture("uSampler",0,this.texture),t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.setupAdditionalVariables(),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}r.prototype.draw.apply(this,arguments)},a.prototype._setupAttribute=function(t,e,n,r){var i=this.core.gl,o=this.shader();i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),i.enableVertexAttribArray(o.attribute_locations[t]),i.vertexAttribPointer(o.attribute_locations[t],r,i.FLOAT,!1,0,0)},a.prototype._setupTexture=function(t,e,n){var r=this.core.gl,i=this.shader();r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.uniform1i(i.uniform_locations[t],e)},a.prototype.z=function(t){return void 0!==t&&(this._z=t),this._z},a.prototype.shader=function(){return this.core.sprite_3d_shader},a.prototype.setupAdditionalVariables=function(){},a.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},a.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},a.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},a.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},a.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},a.prototype.isShow=function(){return!0},a.prototype.spriteAnimationSpan=function(){return 0},a.prototype.spriteIndices=function(){return[{x:0,y:0}]},a.prototype.spriteWidth=function(){return 0},a.prototype.spriteHeight=function(){return 0},a.prototype.rotateAdjust=function(){return 0},a.prototype.scaleWidth=function(){return 1},a.prototype.scaleHeight=function(){return 1},a.prototype.isReflect=function(){return!1},t.exports=a},function(t,e,n){"use strict";var r={SPRITE3D:{}};r.SPRITE3D.V_ITEM_SIZE=3,r.SPRITE3D.V_ITEM_NUM=4,r.SPRITE3D.V_SIZE=r.SPRITE3D.V_ITEM_SIZE*r.SPRITE3D.V_ITEM_NUM,r.SPRITE3D.C_ITEM_SIZE=2,r.SPRITE3D.C_ITEM_NUM=4,r.SPRITE3D.C_SIZE=r.SPRITE3D.C_ITEM_SIZE*r.SPRITE3D.C_ITEM_NUM,r.SPRITE3D.I_ITEM_SIZE=1,r.SPRITE3D.I_ITEM_NUM=6,r.SPRITE3D.I_SIZE=r.SPRITE3D.I_ITEM_SIZE*r.SPRITE3D.I_ITEM_NUM,r.SPRITE3D.A_ITEM_SIZE=4,r.SPRITE3D.A_ITEM_NUM=4,r.SPRITE3D.A_SIZE=r.SPRITE3D.A_ITEM_SIZE*r.SPRITE3D.A_ITEM_NUM,t.exports=r},function(t,e,n){"use strict";var r=n(1),i=function(t){r.apply(this,arguments),this.objects={}};n(0).inherit(i,r),i.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={}},i.prototype.beforeDraw=function(){for(var t in r.prototype.beforeDraw.apply(this,arguments),this.objects)this.objects[t].beforeDraw()},i.prototype.draw=function(){for(var t in r.prototype.draw.apply(this,arguments),this.objects)this.objects[t].draw()},i.prototype.afterDraw=function(){for(var t in r.prototype.afterDraw.apply(this,arguments),this.objects)this.objects[t].afterDraw()},i.prototype.addObject=function(t){this.objects[t.id]=t},i.prototype.addObjects=function(t){throw new Error("not implemented yet.")},i.prototype.removeAllObject=function(){this.objects={}},i.prototype.removeObject=function(t){return this.remove(t.id)},i.prototype.existsObject=function(t){return t.id in this.objects},i.prototype.remove=function(t){var e=this.objects[t];return delete this.objects[t],e},i.prototype.get=function(t){return this.objects[t]},i.prototype.getRandom=function(){var t=Object.keys(this.objects),e=t[Math.floor(Math.random()*t.length)];return this.objects[e]},i.prototype.forEach=function(t){for(var e in this.objects)t(this.objects[e])},i.prototype.count=function(){return Object.keys(this.objects).length},i.prototype.checkCollisionWithObject=function(t){var e=!1;for(var n in this.objects){var r=this.objects[n];t.intersect(r)&&(t.onCollision(r),r.onCollision(t),e=!0)}return e},i.prototype.checkCollisionWithContainer=function(t){for(var e in this.objects)for(var n in t.objects)if(this.objects[e].checkCollision(t.objects[n])){var r=this.objects[e],i=t.objects[n];if(r.onCollision(i),i.onCollision(r),!this.objects[e])break}},i.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},t.exports=i},function(t,e,n){"use strict";var r=n(1),i=n(0),o=n(28),s=n(23).SPRITE3D,a=function(t,e){r.apply(this,arguments),this.Class=e,this.objects={},this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[];var n=this.core.gl;this.vBuffer=n.createBuffer(),this.cBuffer=n.createBuffer(),this.iBuffer=n.createBuffer(),this.aBuffer=n.createBuffer(),this.mvMatrix=o.mat4.create(),this.pMatrix=o.mat4.create()};i.inherit(a,r),a.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={},this._initmvpMatrix()},a.prototype._initmvpMatrix=function(){o.mat4.identity(this.mvMatrix),o.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},a.prototype._setOrthographicProjection=function(){o.mat4.identity(this.pMatrix);o.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,.1,10)},a.prototype.beforeDraw=function(){for(var t in r.prototype.beforeDraw.apply(this,arguments),this.objects)this.objects[t].beforeDraw();this._updateAttributes()},a.prototype._updateAttributes=function(){this._resetAttributes();var t=0;for(var e in this.objects){var n=this.objects[e];if(n.isShow()){var r;for(r=0;r<s.V_SIZE;r++)this.vertices[t*s.V_SIZE+r]=n.vertices[r];for(r=0;r<s.C_SIZE;r++)this.coordinates[t*s.C_SIZE+r]=n.coordinates[r];for(r=0;r<s.I_SIZE;r++)this.indices[t*s.I_SIZE+r]=t*s.V_ITEM_NUM+n.indices[r];for(r=0;r<s.A_SIZE;r++)this.colors[t*s.A_SIZE+r]=n.colors[r];t++}}},a.prototype._resetAttributes=function(){this.vertices.length=0,this.coordinates.length=0,this.indices.length=0,this.colors.length=0},a.prototype.draw=function(){if(r.prototype.draw.apply(this,arguments),0!==this.vertices.length){var t=this.core.gl,e=this.shader();for(var n in t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),s.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),s.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),s.A_ITEM_SIZE),this.objects){var i=this.objects[n].texture;this._setupTexture("uSampler",0,i);break}t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}},a.prototype._setupAttribute=function(t,e,n,r){var i=this.core.gl,o=this.shader();i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,n,i.STATIC_DRAW),i.enableVertexAttribArray(o.attribute_locations[t]),i.vertexAttribPointer(o.attribute_locations[t],r,i.FLOAT,!1,0,0)},a.prototype._setupTexture=function(t,e,n){var r=this.core.gl,i=this.shader();r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,n),r.uniform1i(i.uniform_locations[t],e)},a.prototype.afterDraw=function(){for(var t in r.prototype.afterDraw.apply(this,arguments),this.objects)this.objects[t].afterDraw()},a.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},a.prototype.remove=function(t){delete this.objects[t]},a.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var n=this.objects[e];t.checkCollision(n)&&(t.onCollision(n),n.onCollision(t))}},a.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var n in t.objects)if(this.objects[e].checkCollision(t.objects[n])){var r=this.objects[e],i=t.objects[n];if(r.onCollision(i),i.onCollision(r),!this.objects[e])break}},a.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},a.prototype.shader=function(){return this.core.sprite_3d_shader},t.exports=a},function(t,e,n){"use strict";var r=n(1),i=n(0),o=function(t,e,n,o,s,a){r.apply(this,arguments),this.x(e),this.y(n),this._width=o,this._height=s,this._draw_function=null,void 0!==a&&(this._draw_function=i.bind(a,this)),this._is_show_rect=!1,this._collision_callback=null};i.inherit(o,r),o.prototype.onCollision=function(t){this._collision_callback&&this._collision_callback(t)},o.prototype.collisionWidth=function(){return this._width},o.prototype.collisionHeight=function(){return this._height},o.prototype.setShowRect=function(){return this._is_show_rect=!0,this},o.prototype.setVariable=function(t,e){return this[t]=e,this},o.prototype.setCollisionCallback=function(t){this._collision_callback=i.bind(t,this)},o.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),this._draw_function&&this._draw_function(),t.restore(),this._is_show_rect&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore())},t.exports=o},function(t,e,n){"use strict";var r=n(8),i=function(t){r.apply(this,arguments)};n(0).inherit(i,r);var o="hakurei_engine",s="save";i.KEY=function(){return!this.isLocalMode()&&window&&window.location?[o,s,window.location.pathname].join(":"):s},t.exports=i},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"EPSILON",function(){return l}),n.d(r,"ARRAY_TYPE",function(){return d}),n.d(r,"RANDOM",function(){return p}),n.d(r,"setMatrixArrayType",function(){return m}),n.d(r,"toRadian",function(){return g}),n.d(r,"equals",function(){return v});var i={};n.r(i),n.d(i,"create",function(){return b}),n.d(i,"clone",function(){return w}),n.d(i,"copy",function(){return M}),n.d(i,"identity",function(){return x}),n.d(i,"fromValues",function(){return S}),n.d(i,"set",function(){return E}),n.d(i,"transpose",function(){return T}),n.d(i,"invert",function(){return A}),n.d(i,"adjoint",function(){return I}),n.d(i,"determinant",function(){return C}),n.d(i,"multiply",function(){return R}),n.d(i,"rotate",function(){return P}),n.d(i,"scale",function(){return F}),n.d(i,"fromRotation",function(){return B}),n.d(i,"fromScaling",function(){return k}),n.d(i,"str",function(){return D}),n.d(i,"frob",function(){return L}),n.d(i,"LDU",function(){return O}),n.d(i,"add",function(){return N}),n.d(i,"subtract",function(){return U}),n.d(i,"exactEquals",function(){return j}),n.d(i,"equals",function(){return G}),n.d(i,"multiplyScalar",function(){return q}),n.d(i,"multiplyScalarAndAdd",function(){return W}),n.d(i,"mul",function(){return V}),n.d(i,"sub",function(){return X});var o={};n.r(o),n.d(o,"create",function(){return H}),n.d(o,"clone",function(){return Y}),n.d(o,"copy",function(){return K}),n.d(o,"identity",function(){return Z}),n.d(o,"fromValues",function(){return z}),n.d(o,"set",function(){return Q}),n.d(o,"invert",function(){return J}),n.d(o,"determinant",function(){return $}),n.d(o,"multiply",function(){return tt}),n.d(o,"rotate",function(){return et}),n.d(o,"scale",function(){return nt}),n.d(o,"translate",function(){return rt}),n.d(o,"fromRotation",function(){return it}),n.d(o,"fromScaling",function(){return ot}),n.d(o,"fromTranslation",function(){return st}),n.d(o,"str",function(){return at}),n.d(o,"frob",function(){return ut}),n.d(o,"add",function(){return ct}),n.d(o,"subtract",function(){return ht}),n.d(o,"multiplyScalar",function(){return ft}),n.d(o,"multiplyScalarAndAdd",function(){return _t}),n.d(o,"exactEquals",function(){return lt}),n.d(o,"equals",function(){return dt}),n.d(o,"mul",function(){return pt}),n.d(o,"sub",function(){return mt});var s={};n.r(s),n.d(s,"create",function(){return yt}),n.d(s,"fromMat4",function(){return gt}),n.d(s,"clone",function(){return vt}),n.d(s,"copy",function(){return bt}),n.d(s,"fromValues",function(){return wt}),n.d(s,"set",function(){return Mt}),n.d(s,"identity",function(){return xt}),n.d(s,"transpose",function(){return St}),n.d(s,"invert",function(){return Et}),n.d(s,"adjoint",function(){return Tt}),n.d(s,"determinant",function(){return At}),n.d(s,"multiply",function(){return It}),n.d(s,"translate",function(){return Ct}),n.d(s,"rotate",function(){return Rt}),n.d(s,"scale",function(){return Pt}),n.d(s,"fromTranslation",function(){return Ft}),n.d(s,"fromRotation",function(){return Bt}),n.d(s,"fromScaling",function(){return kt}),n.d(s,"fromMat2d",function(){return Dt}),n.d(s,"fromQuat",function(){return Lt}),n.d(s,"normalFromMat4",function(){return Ot}),n.d(s,"projection",function(){return Nt}),n.d(s,"str",function(){return Ut}),n.d(s,"frob",function(){return jt}),n.d(s,"add",function(){return Gt}),n.d(s,"subtract",function(){return qt}),n.d(s,"multiplyScalar",function(){return Wt}),n.d(s,"multiplyScalarAndAdd",function(){return Vt}),n.d(s,"exactEquals",function(){return Xt}),n.d(s,"equals",function(){return Ht}),n.d(s,"mul",function(){return Yt}),n.d(s,"sub",function(){return Kt});var a={};n.r(a),n.d(a,"create",function(){return Zt}),n.d(a,"clone",function(){return zt}),n.d(a,"copy",function(){return Qt}),n.d(a,"fromValues",function(){return Jt}),n.d(a,"set",function(){return $t}),n.d(a,"identity",function(){return te}),n.d(a,"transpose",function(){return ee}),n.d(a,"invert",function(){return ne}),n.d(a,"adjoint",function(){return re}),n.d(a,"determinant",function(){return ie}),n.d(a,"multiply",function(){return oe}),n.d(a,"translate",function(){return se}),n.d(a,"scale",function(){return ae}),n.d(a,"rotate",function(){return ue}),n.d(a,"rotateX",function(){return ce}),n.d(a,"rotateY",function(){return he}),n.d(a,"rotateZ",function(){return fe}),n.d(a,"fromTranslation",function(){return _e}),n.d(a,"fromScaling",function(){return le}),n.d(a,"fromRotation",function(){return de}),n.d(a,"fromXRotation",function(){return pe}),n.d(a,"fromYRotation",function(){return me}),n.d(a,"fromZRotation",function(){return ye}),n.d(a,"fromRotationTranslation",function(){return ge}),n.d(a,"fromQuat2",function(){return ve}),n.d(a,"getTranslation",function(){return be}),n.d(a,"getScaling",function(){return we}),n.d(a,"getRotation",function(){return Me}),n.d(a,"fromRotationTranslationScale",function(){return xe}),n.d(a,"fromRotationTranslationScaleOrigin",function(){return Se}),n.d(a,"fromQuat",function(){return Ee}),n.d(a,"frustum",function(){return Te}),n.d(a,"perspective",function(){return Ae}),n.d(a,"perspectiveFromFieldOfView",function(){return Ie}),n.d(a,"ortho",function(){return Ce}),n.d(a,"lookAt",function(){return Re}),n.d(a,"targetTo",function(){return Pe}),n.d(a,"str",function(){return Fe}),n.d(a,"frob",function(){return Be}),n.d(a,"add",function(){return ke}),n.d(a,"subtract",function(){return De}),n.d(a,"multiplyScalar",function(){return Le}),n.d(a,"multiplyScalarAndAdd",function(){return Oe}),n.d(a,"exactEquals",function(){return Ne}),n.d(a,"equals",function(){return Ue}),n.d(a,"mul",function(){return je}),n.d(a,"sub",function(){return Ge});var u={};n.r(u),n.d(u,"create",function(){return qe}),n.d(u,"clone",function(){return We}),n.d(u,"length",function(){return Ve}),n.d(u,"fromValues",function(){return Xe}),n.d(u,"copy",function(){return He}),n.d(u,"set",function(){return Ye}),n.d(u,"add",function(){return Ke}),n.d(u,"subtract",function(){return Ze}),n.d(u,"multiply",function(){return ze}),n.d(u,"divide",function(){return Qe}),n.d(u,"ceil",function(){return Je}),n.d(u,"floor",function(){return $e}),n.d(u,"min",function(){return tn}),n.d(u,"max",function(){return en}),n.d(u,"round",function(){return nn}),n.d(u,"scale",function(){return rn}),n.d(u,"scaleAndAdd",function(){return on}),n.d(u,"distance",function(){return sn}),n.d(u,"squaredDistance",function(){return an}),n.d(u,"squaredLength",function(){return un}),n.d(u,"negate",function(){return cn}),n.d(u,"inverse",function(){return hn}),n.d(u,"normalize",function(){return fn}),n.d(u,"dot",function(){return _n}),n.d(u,"cross",function(){return ln}),n.d(u,"lerp",function(){return dn}),n.d(u,"hermite",function(){return pn}),n.d(u,"bezier",function(){return mn}),n.d(u,"random",function(){return yn}),n.d(u,"transformMat4",function(){return gn}),n.d(u,"transformMat3",function(){return vn}),n.d(u,"transformQuat",function(){return bn}),n.d(u,"rotateX",function(){return wn}),n.d(u,"rotateY",function(){return Mn}),n.d(u,"rotateZ",function(){return xn}),n.d(u,"angle",function(){return Sn}),n.d(u,"str",function(){return En}),n.d(u,"exactEquals",function(){return Tn}),n.d(u,"equals",function(){return An}),n.d(u,"sub",function(){return In}),n.d(u,"mul",function(){return Cn}),n.d(u,"div",function(){return Rn}),n.d(u,"dist",function(){return Pn}),n.d(u,"sqrDist",function(){return Fn}),n.d(u,"len",function(){return Bn}),n.d(u,"sqrLen",function(){return kn}),n.d(u,"forEach",function(){return Dn});var c={};n.r(c),n.d(c,"create",function(){return Ln}),n.d(c,"clone",function(){return On}),n.d(c,"fromValues",function(){return Nn}),n.d(c,"copy",function(){return Un}),n.d(c,"set",function(){return jn}),n.d(c,"add",function(){return Gn}),n.d(c,"subtract",function(){return qn}),n.d(c,"multiply",function(){return Wn}),n.d(c,"divide",function(){return Vn}),n.d(c,"ceil",function(){return Xn}),n.d(c,"floor",function(){return Hn}),n.d(c,"min",function(){return Yn}),n.d(c,"max",function(){return Kn}),n.d(c,"round",function(){return Zn}),n.d(c,"scale",function(){return zn}),n.d(c,"scaleAndAdd",function(){return Qn}),n.d(c,"distance",function(){return Jn}),n.d(c,"squaredDistance",function(){return $n}),n.d(c,"length",function(){return tr}),n.d(c,"squaredLength",function(){return er}),n.d(c,"negate",function(){return nr}),n.d(c,"inverse",function(){return rr}),n.d(c,"normalize",function(){return ir}),n.d(c,"dot",function(){return or}),n.d(c,"lerp",function(){return sr}),n.d(c,"random",function(){return ar}),n.d(c,"transformMat4",function(){return ur}),n.d(c,"transformQuat",function(){return cr}),n.d(c,"str",function(){return hr}),n.d(c,"exactEquals",function(){return fr}),n.d(c,"equals",function(){return _r}),n.d(c,"sub",function(){return lr}),n.d(c,"mul",function(){return dr}),n.d(c,"div",function(){return pr}),n.d(c,"dist",function(){return mr}),n.d(c,"sqrDist",function(){return yr}),n.d(c,"len",function(){return gr}),n.d(c,"sqrLen",function(){return vr}),n.d(c,"forEach",function(){return br});var h={};n.r(h),n.d(h,"create",function(){return wr}),n.d(h,"identity",function(){return Mr}),n.d(h,"setAxisAngle",function(){return xr}),n.d(h,"getAxisAngle",function(){return Sr}),n.d(h,"multiply",function(){return Er}),n.d(h,"rotateX",function(){return Tr}),n.d(h,"rotateY",function(){return Ar}),n.d(h,"rotateZ",function(){return Ir}),n.d(h,"calculateW",function(){return Cr}),n.d(h,"slerp",function(){return Rr}),n.d(h,"random",function(){return Pr}),n.d(h,"invert",function(){return Fr}),n.d(h,"conjugate",function(){return Br}),n.d(h,"fromMat3",function(){return kr}),n.d(h,"fromEuler",function(){return Dr}),n.d(h,"str",function(){return Lr}),n.d(h,"clone",function(){return Or}),n.d(h,"fromValues",function(){return Nr}),n.d(h,"copy",function(){return Ur}),n.d(h,"set",function(){return jr}),n.d(h,"add",function(){return Gr}),n.d(h,"mul",function(){return qr}),n.d(h,"scale",function(){return Wr}),n.d(h,"dot",function(){return Vr}),n.d(h,"lerp",function(){return Xr}),n.d(h,"length",function(){return Hr}),n.d(h,"len",function(){return Yr}),n.d(h,"squaredLength",function(){return Kr}),n.d(h,"sqrLen",function(){return Zr}),n.d(h,"normalize",function(){return zr}),n.d(h,"exactEquals",function(){return Qr}),n.d(h,"equals",function(){return Jr}),n.d(h,"rotationTo",function(){return $r}),n.d(h,"sqlerp",function(){return ti}),n.d(h,"setAxes",function(){return ei});var f={};n.r(f),n.d(f,"create",function(){return ni}),n.d(f,"clone",function(){return ri}),n.d(f,"fromValues",function(){return ii}),n.d(f,"fromRotationTranslationValues",function(){return oi}),n.d(f,"fromRotationTranslation",function(){return si}),n.d(f,"fromTranslation",function(){return ai}),n.d(f,"fromRotation",function(){return ui}),n.d(f,"fromMat4",function(){return ci}),n.d(f,"copy",function(){return hi}),n.d(f,"identity",function(){return fi}),n.d(f,"set",function(){return _i}),n.d(f,"getReal",function(){return li}),n.d(f,"getDual",function(){return di}),n.d(f,"setReal",function(){return pi}),n.d(f,"setDual",function(){return mi}),n.d(f,"getTranslation",function(){return yi}),n.d(f,"translate",function(){return gi}),n.d(f,"rotateX",function(){return vi}),n.d(f,"rotateY",function(){return bi}),n.d(f,"rotateZ",function(){return wi}),n.d(f,"rotateByQuatAppend",function(){return Mi}),n.d(f,"rotateByQuatPrepend",function(){return xi}),n.d(f,"rotateAroundAxis",function(){return Si}),n.d(f,"add",function(){return Ei}),n.d(f,"multiply",function(){return Ti}),n.d(f,"mul",function(){return Ai}),n.d(f,"scale",function(){return Ii}),n.d(f,"dot",function(){return Ci}),n.d(f,"lerp",function(){return Ri}),n.d(f,"invert",function(){return Pi}),n.d(f,"conjugate",function(){return Fi}),n.d(f,"length",function(){return Bi}),n.d(f,"len",function(){return ki}),n.d(f,"squaredLength",function(){return Di}),n.d(f,"sqrLen",function(){return Li}),n.d(f,"normalize",function(){return Oi}),n.d(f,"str",function(){return Ni}),n.d(f,"exactEquals",function(){return Ui}),n.d(f,"equals",function(){return ji});var _={};n.r(_),n.d(_,"create",function(){return Gi}),n.d(_,"clone",function(){return qi}),n.d(_,"fromValues",function(){return Wi}),n.d(_,"copy",function(){return Vi}),n.d(_,"set",function(){return Xi}),n.d(_,"add",function(){return Hi}),n.d(_,"subtract",function(){return Yi}),n.d(_,"multiply",function(){return Ki}),n.d(_,"divide",function(){return Zi}),n.d(_,"ceil",function(){return zi}),n.d(_,"floor",function(){return Qi}),n.d(_,"min",function(){return Ji}),n.d(_,"max",function(){return $i}),n.d(_,"round",function(){return to}),n.d(_,"scale",function(){return eo}),n.d(_,"scaleAndAdd",function(){return no}),n.d(_,"distance",function(){return ro}),n.d(_,"squaredDistance",function(){return io}),n.d(_,"length",function(){return oo}),n.d(_,"squaredLength",function(){return so}),n.d(_,"negate",function(){return ao}),n.d(_,"inverse",function(){return uo}),n.d(_,"normalize",function(){return co}),n.d(_,"dot",function(){return ho}),n.d(_,"cross",function(){return fo}),n.d(_,"lerp",function(){return _o}),n.d(_,"random",function(){return lo}),n.d(_,"transformMat2",function(){return po}),n.d(_,"transformMat2d",function(){return mo}),n.d(_,"transformMat3",function(){return yo}),n.d(_,"transformMat4",function(){return go}),n.d(_,"rotate",function(){return vo}),n.d(_,"angle",function(){return bo}),n.d(_,"str",function(){return wo}),n.d(_,"exactEquals",function(){return Mo}),n.d(_,"equals",function(){return xo}),n.d(_,"len",function(){return So}),n.d(_,"sub",function(){return Eo}),n.d(_,"mul",function(){return To}),n.d(_,"div",function(){return Ao}),n.d(_,"dist",function(){return Io}),n.d(_,"sqrDist",function(){return Co}),n.d(_,"sqrLen",function(){return Ro}),n.d(_,"forEach",function(){return Po});var l=1e-6,d="undefined"!=typeof Float32Array?Float32Array:Array,p=Math.random;function m(t){d=t}var y=Math.PI/180;function g(t){return t*y}function v(t,e){return Math.abs(t-e)<=l*Math.max(1,Math.abs(t),Math.abs(e))}function b(){var t=new d(4);return d!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function w(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function S(t,e,n,r){var i=new d(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function E(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function T(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function A(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*o-i*r;return s?(s=1/s,t[0]=o*s,t[1]=-r*s,t[2]=-i*s,t[3]=n*s,t):null}function I(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function C(t){return t[0]*t[3]-t[2]*t[1]}function R(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*a+o*u,t[1]=i*a+s*u,t[2]=r*c+o*h,t[3]=i*c+s*h,t}function P(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*a,t[1]=i*u+s*a,t[2]=r*-a+o*u,t[3]=i*-a+s*u,t}function F(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],u=n[1];return t[0]=r*a,t[1]=i*a,t[2]=o*u,t[3]=s*u,t}function B(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function k(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function D(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function L(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function O(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function N(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function U(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function j(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function G(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=e[0],a=e[1],u=e[2],c=e[3];return Math.abs(n-s)<=l*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=l*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=l*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=l*Math.max(1,Math.abs(o),Math.abs(c))}function q(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function W(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}var V=R,X=U;function H(){var t=new d(6);return d!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Y(t){var e=new d(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function K(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Z(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function z(t,e,n,r,i,o){var s=new d(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s[4]=i,s[5]=o,s}function Q(t,e,n,r,i,o,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t}function J(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=n*o-r*i;return u?(u=1/u,t[0]=o*u,t[1]=-r*u,t[2]=-i*u,t[3]=n*u,t[4]=(i*a-o*s)*u,t[5]=(r*s-n*a)*u,t):null}function $(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=n[0],h=n[1],f=n[2],_=n[3],l=n[4],d=n[5];return t[0]=r*c+o*h,t[1]=i*c+s*h,t[2]=r*f+o*_,t[3]=i*f+s*_,t[4]=r*l+o*d+a,t[5]=i*l+s*d+u,t}function et(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=Math.sin(n),h=Math.cos(n);return t[0]=r*h+o*c,t[1]=i*h+s*c,t[2]=r*-c+o*h,t[3]=i*-c+s*h,t[4]=a,t[5]=u,t}function nt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r*c,t[1]=i*c,t[2]=o*h,t[3]=s*h,t[4]=a,t[5]=u,t}function rt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=n[0],h=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=r*c+o*h+a,t[5]=i*c+s*h+u,t}function it(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function st(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function at(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function ct(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function ht(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function ft(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function _t(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function lt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function dt(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=e[0],c=e[1],h=e[2],f=e[3],_=e[4],d=e[5];return Math.abs(n-u)<=l*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-c)<=l*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-h)<=l*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-f)<=l*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-_)<=l*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-d)<=l*Math.max(1,Math.abs(a),Math.abs(d))}var pt=tt,mt=ht;function yt(){var t=new d(9);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function gt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function vt(t){var e=new d(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function wt(t,e,n,r,i,o,s,a,u){var c=new d(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=i,c[5]=o,c[6]=s,c[7]=a,c[8]=u,c}function Mt(t,e,n,r,i,o,s,a,u,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=u,t[8]=c,t}function xt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function St(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Et(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],h=e[8],f=h*s-a*c,_=-h*o+a*u,l=c*o-s*u,d=n*f+r*_+i*l;return d?(d=1/d,t[0]=f*d,t[1]=(-h*r+i*c)*d,t[2]=(a*r-i*s)*d,t[3]=_*d,t[4]=(h*n-i*u)*d,t[5]=(-a*n+i*o)*d,t[6]=l*d,t[7]=(-c*n+r*u)*d,t[8]=(s*n-r*o)*d,t):null}function Tt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],h=e[8];return t[0]=s*h-a*c,t[1]=i*c-r*h,t[2]=r*a-i*s,t[3]=a*u-o*h,t[4]=n*h-i*u,t[5]=i*o-n*a,t[6]=o*c-s*u,t[7]=r*u-n*c,t[8]=n*s-r*o,t}function At(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],c=t[8];return e*(c*o-s*u)+n*(-c*i+s*a)+r*(u*i-o*a)}function It(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=e[8],_=n[0],l=n[1],d=n[2],p=n[3],m=n[4],y=n[5],g=n[6],v=n[7],b=n[8];return t[0]=_*r+l*s+d*c,t[1]=_*i+l*a+d*h,t[2]=_*o+l*u+d*f,t[3]=p*r+m*s+y*c,t[4]=p*i+m*a+y*h,t[5]=p*o+m*u+y*f,t[6]=g*r+v*s+b*c,t[7]=g*i+v*a+b*h,t[8]=g*o+v*u+b*f,t}function Ct(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=e[8],_=n[0],l=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=u,t[6]=_*r+l*s+c,t[7]=_*i+l*a+h,t[8]=_*o+l*u+f,t}function Rt(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=e[8],_=Math.sin(n),l=Math.cos(n);return t[0]=l*r+_*s,t[1]=l*i+_*a,t[2]=l*o+_*u,t[3]=l*s-_*r,t[4]=l*a-_*i,t[5]=l*u-_*o,t[6]=c,t[7]=h,t[8]=f,t}function Pt(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Ft(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Bt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function kt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Dt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Lt(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,u=i+i,c=n*s,h=r*s,f=r*a,_=i*s,l=i*a,d=i*u,p=o*s,m=o*a,y=o*u;return t[0]=1-f-d,t[3]=h-y,t[6]=_+m,t[1]=h+y,t[4]=1-c-d,t[7]=l-p,t[2]=_-m,t[5]=l+p,t[8]=1-c-f,t}function Ot(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],h=e[8],f=e[9],_=e[10],l=e[11],d=e[12],p=e[13],m=e[14],y=e[15],g=n*a-r*s,v=n*u-i*s,b=n*c-o*s,w=r*u-i*a,M=r*c-o*a,x=i*c-o*u,S=h*p-f*d,E=h*m-_*d,T=h*y-l*d,A=f*m-_*p,I=f*y-l*p,C=_*y-l*m,R=g*C-v*I+b*A+w*T-M*E+x*S;return R?(R=1/R,t[0]=(a*C-u*I+c*A)*R,t[1]=(u*T-s*C-c*E)*R,t[2]=(s*I-a*T+c*S)*R,t[3]=(i*I-r*C-o*A)*R,t[4]=(n*C-i*T+o*E)*R,t[5]=(r*T-n*I-o*S)*R,t[6]=(p*x-m*M+y*w)*R,t[7]=(m*b-d*x-y*v)*R,t[8]=(d*M-p*b+y*g)*R,t):null}function Nt(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ut(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function jt(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function Gt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function qt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Wt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Vt(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Xt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Ht(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],h=t[8],f=e[0],_=e[1],d=e[2],p=e[3],m=e[4],y=e[5],g=e[6],v=e[7],b=e[8];return Math.abs(n-f)<=l*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-_)<=l*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-d)<=l*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=l*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=l*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-y)<=l*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(u-g)<=l*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-v)<=l*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-b)<=l*Math.max(1,Math.abs(h),Math.abs(b))}var Yt=It,Kt=qt;function Zt(){var t=new d(16);return d!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function zt(t){var e=new d(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Jt(t,e,n,r,i,o,s,a,u,c,h,f,_,l,p,m){var y=new d(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=r,y[4]=i,y[5]=o,y[6]=s,y[7]=a,y[8]=u,y[9]=c,y[10]=h,y[11]=f,y[12]=_,y[13]=l,y[14]=p,y[15]=m,y}function $t(t,e,n,r,i,o,s,a,u,c,h,f,_,l,d,p,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=u,t[8]=c,t[9]=h,t[10]=f,t[11]=_,t[12]=l,t[13]=d,t[14]=p,t[15]=m,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ne(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],h=e[8],f=e[9],_=e[10],l=e[11],d=e[12],p=e[13],m=e[14],y=e[15],g=n*a-r*s,v=n*u-i*s,b=n*c-o*s,w=r*u-i*a,M=r*c-o*a,x=i*c-o*u,S=h*p-f*d,E=h*m-_*d,T=h*y-l*d,A=f*m-_*p,I=f*y-l*p,C=_*y-l*m,R=g*C-v*I+b*A+w*T-M*E+x*S;return R?(R=1/R,t[0]=(a*C-u*I+c*A)*R,t[1]=(i*I-r*C-o*A)*R,t[2]=(p*x-m*M+y*w)*R,t[3]=(_*M-f*x-l*w)*R,t[4]=(u*T-s*C-c*E)*R,t[5]=(n*C-i*T+o*E)*R,t[6]=(m*b-d*x-y*v)*R,t[7]=(h*x-_*b+l*v)*R,t[8]=(s*I-a*T+c*S)*R,t[9]=(r*T-n*I-o*S)*R,t[10]=(d*M-p*b+y*g)*R,t[11]=(f*b-h*M-l*g)*R,t[12]=(a*E-s*A-u*S)*R,t[13]=(n*A-r*E+i*S)*R,t[14]=(p*v-d*w-m*g)*R,t[15]=(h*w-f*v+_*g)*R,t):null}function re(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],c=e[7],h=e[8],f=e[9],_=e[10],l=e[11],d=e[12],p=e[13],m=e[14],y=e[15];return t[0]=a*(_*y-l*m)-f*(u*y-c*m)+p*(u*l-c*_),t[1]=-(r*(_*y-l*m)-f*(i*y-o*m)+p*(i*l-o*_)),t[2]=r*(u*y-c*m)-a*(i*y-o*m)+p*(i*c-o*u),t[3]=-(r*(u*l-c*_)-a*(i*l-o*_)+f*(i*c-o*u)),t[4]=-(s*(_*y-l*m)-h*(u*y-c*m)+d*(u*l-c*_)),t[5]=n*(_*y-l*m)-h*(i*y-o*m)+d*(i*l-o*_),t[6]=-(n*(u*y-c*m)-s*(i*y-o*m)+d*(i*c-o*u)),t[7]=n*(u*l-c*_)-s*(i*l-o*_)+h*(i*c-o*u),t[8]=s*(f*y-l*p)-h*(a*y-c*p)+d*(a*l-c*f),t[9]=-(n*(f*y-l*p)-h*(r*y-o*p)+d*(r*l-o*f)),t[10]=n*(a*y-c*p)-s*(r*y-o*p)+d*(r*c-o*a),t[11]=-(n*(a*l-c*f)-s*(r*l-o*f)+h*(r*c-o*a)),t[12]=-(s*(f*m-_*p)-h*(a*m-u*p)+d*(a*_-u*f)),t[13]=n*(f*m-_*p)-h*(r*m-i*p)+d*(r*_-i*f),t[14]=-(n*(a*m-u*p)-s*(r*m-i*p)+d*(r*u-i*a)),t[15]=n*(a*_-u*f)-s*(r*_-i*f)+h*(r*u-i*a),t}function ie(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],h=t[9],f=t[10],_=t[11],l=t[12],d=t[13],p=t[14],m=t[15];return(e*s-n*o)*(f*m-_*p)-(e*a-r*o)*(h*m-_*d)+(e*u-i*o)*(h*p-f*d)+(n*a-r*s)*(c*m-_*l)-(n*u-i*s)*(c*p-f*l)+(r*u-i*a)*(c*d-h*l)}function oe(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=e[8],_=e[9],l=e[10],d=e[11],p=e[12],m=e[13],y=e[14],g=e[15],v=n[0],b=n[1],w=n[2],M=n[3];return t[0]=v*r+b*a+w*f+M*p,t[1]=v*i+b*u+w*_+M*m,t[2]=v*o+b*c+w*l+M*y,t[3]=v*s+b*h+w*d+M*g,v=n[4],b=n[5],w=n[6],M=n[7],t[4]=v*r+b*a+w*f+M*p,t[5]=v*i+b*u+w*_+M*m,t[6]=v*o+b*c+w*l+M*y,t[7]=v*s+b*h+w*d+M*g,v=n[8],b=n[9],w=n[10],M=n[11],t[8]=v*r+b*a+w*f+M*p,t[9]=v*i+b*u+w*_+M*m,t[10]=v*o+b*c+w*l+M*y,t[11]=v*s+b*h+w*d+M*g,v=n[12],b=n[13],w=n[14],M=n[15],t[12]=v*r+b*a+w*f+M*p,t[13]=v*i+b*u+w*_+M*m,t[14]=v*o+b*c+w*l+M*y,t[15]=v*s+b*h+w*d+M*g,t}function se(t,e,n){var r=n[0],i=n[1],o=n[2],s=void 0,a=void 0,u=void 0,c=void 0,h=void 0,f=void 0,_=void 0,l=void 0,d=void 0,p=void 0,m=void 0,y=void 0;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*o+e[12],t[13]=e[1]*r+e[5]*i+e[9]*o+e[13],t[14]=e[2]*r+e[6]*i+e[10]*o+e[14],t[15]=e[3]*r+e[7]*i+e[11]*o+e[15]):(s=e[0],a=e[1],u=e[2],c=e[3],h=e[4],f=e[5],_=e[6],l=e[7],d=e[8],p=e[9],m=e[10],y=e[11],t[0]=s,t[1]=a,t[2]=u,t[3]=c,t[4]=h,t[5]=f,t[6]=_,t[7]=l,t[8]=d,t[9]=p,t[10]=m,t[11]=y,t[12]=s*r+h*i+d*o+e[12],t[13]=a*r+f*i+p*o+e[13],t[14]=u*r+_*i+m*o+e[14],t[15]=c*r+l*i+y*o+e[15]),t}function ae(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ue(t,e,n,r){var i,o,s,a,u,c,h,f,_,d,p,m,y,g,v,b,w,M,x,S,E,T,A,I,C=r[0],R=r[1],P=r[2],F=Math.sqrt(C*C+R*R+P*P);return F<l?null:(C*=F=1/F,R*=F,P*=F,i=Math.sin(n),s=1-(o=Math.cos(n)),a=e[0],u=e[1],c=e[2],h=e[3],f=e[4],_=e[5],d=e[6],p=e[7],m=e[8],y=e[9],g=e[10],v=e[11],b=C*C*s+o,w=R*C*s+P*i,M=P*C*s-R*i,x=C*R*s-P*i,S=R*R*s+o,E=P*R*s+C*i,T=C*P*s+R*i,A=R*P*s-C*i,I=P*P*s+o,t[0]=a*b+f*w+m*M,t[1]=u*b+_*w+y*M,t[2]=c*b+d*w+g*M,t[3]=h*b+p*w+v*M,t[4]=a*x+f*S+m*E,t[5]=u*x+_*S+y*E,t[6]=c*x+d*S+g*E,t[7]=h*x+p*S+v*E,t[8]=a*T+f*A+m*I,t[9]=u*T+_*A+y*I,t[10]=c*T+d*A+g*I,t[11]=h*T+p*A+v*I,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ce(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],s=e[5],a=e[6],u=e[7],c=e[8],h=e[9],f=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=s*i+h*r,t[6]=a*i+f*r,t[7]=u*i+_*r,t[8]=c*i-o*r,t[9]=h*i-s*r,t[10]=f*i-a*r,t[11]=_*i-u*r,t}function he(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=e[3],c=e[8],h=e[9],f=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=s*i-h*r,t[2]=a*i-f*r,t[3]=u*i-_*r,t[8]=o*r+c*i,t[9]=s*r+h*i,t[10]=a*r+f*i,t[11]=u*r+_*i,t}function fe(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],u=e[3],c=e[4],h=e[5],f=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=s*i+h*r,t[2]=a*i+f*r,t[3]=u*i+_*r,t[4]=c*i-o*r,t[5]=h*i-s*r,t[6]=f*i-a*r,t[7]=_*i-u*r,t}function _e(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function le(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function de(t,e,n){var r,i,o,s=n[0],a=n[1],u=n[2],c=Math.sqrt(s*s+a*a+u*u);return c<l?null:(s*=c=1/c,a*=c,u*=c,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=s*s*o+i,t[1]=a*s*o+u*r,t[2]=u*s*o-a*r,t[3]=0,t[4]=s*a*o-u*r,t[5]=a*a*o+i,t[6]=u*a*o+s*r,t[7]=0,t[8]=s*u*o+a*r,t[9]=a*u*o-s*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function pe(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ye(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ge(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=r+r,u=i+i,c=o+o,h=r*a,f=r*u,_=r*c,l=i*u,d=i*c,p=o*c,m=s*a,y=s*u,g=s*c;return t[0]=1-(l+p),t[1]=f+g,t[2]=_-y,t[3]=0,t[4]=f-g,t[5]=1-(h+p),t[6]=d+m,t[7]=0,t[8]=_+y,t[9]=d-m,t[10]=1-(h+l),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ve(t,e){var n=new d(3),r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=r*r+i*i+o*o+s*s;return f>0?(n[0]=2*(a*s+h*r+u*o-c*i)/f,n[1]=2*(u*s+h*i+c*r-a*o)/f,n[2]=2*(c*s+h*o+a*i-u*r)/f):(n[0]=2*(a*s+h*r+u*o-c*i),n[1]=2*(u*s+h*i+c*r-a*o),n[2]=2*(c*s+h*o+a*i-u*r)),ge(t,e,n),t}function be(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function we(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],s=e[5],a=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(o*o+s*s+a*a),t[2]=Math.sqrt(u*u+c*c+h*h),t}function Me(t,e){var n=e[0]+e[5]+e[10],r=0;return n>0?(r=2*Math.sqrt(n+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function xe(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3],u=i+i,c=o+o,h=s+s,f=i*u,_=i*c,l=i*h,d=o*c,p=o*h,m=s*h,y=a*u,g=a*c,v=a*h,b=r[0],w=r[1],M=r[2];return t[0]=(1-(d+m))*b,t[1]=(_+v)*b,t[2]=(l-g)*b,t[3]=0,t[4]=(_-v)*w,t[5]=(1-(f+m))*w,t[6]=(p+y)*w,t[7]=0,t[8]=(l+g)*M,t[9]=(p-y)*M,t[10]=(1-(f+d))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Se(t,e,n,r,i){var o=e[0],s=e[1],a=e[2],u=e[3],c=o+o,h=s+s,f=a+a,_=o*c,l=o*h,d=o*f,p=s*h,m=s*f,y=a*f,g=u*c,v=u*h,b=u*f,w=r[0],M=r[1],x=r[2],S=i[0],E=i[1],T=i[2],A=(1-(p+y))*w,I=(l+b)*w,C=(d-v)*w,R=(l-b)*M,P=(1-(_+y))*M,F=(m+g)*M,B=(d+v)*x,k=(m-g)*x,D=(1-(_+p))*x;return t[0]=A,t[1]=I,t[2]=C,t[3]=0,t[4]=R,t[5]=P,t[6]=F,t[7]=0,t[8]=B,t[9]=k,t[10]=D,t[11]=0,t[12]=n[0]+S-(A*S+R*E+B*T),t[13]=n[1]+E-(I*S+P*E+k*T),t[14]=n[2]+T-(C*S+F*E+D*T),t[15]=1,t}function Ee(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,u=i+i,c=n*s,h=r*s,f=r*a,_=i*s,l=i*a,d=i*u,p=o*s,m=o*a,y=o*u;return t[0]=1-f-d,t[1]=h+y,t[2]=_-m,t[3]=0,t[4]=h-y,t[5]=1-c-d,t[6]=l+p,t[7]=0,t[8]=_+m,t[9]=l-p,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Te(t,e,n,r,i,o,s){var a=1/(n-e),u=1/(i-r),c=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(s+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*c,t[15]=0,t}function Ae(t,e,n,r,i){var o=1/Math.tan(e/2),s=void 0;return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(s=1/(r-i),t[10]=(i+r)*s,t[14]=2*i*r*s):(t[10]=-1,t[14]=-2*r),t}function Ie(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(s+a),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-a)*u*.5,t[9]=(i-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Ce(t,e,n,r,i,o,s){var a=1/(e-n),u=1/(r-i),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(s+o)*c,t[15]=1,t}function Re(t,e,n,r){var i=void 0,o=void 0,s=void 0,a=void 0,u=void 0,c=void 0,h=void 0,f=void 0,_=void 0,d=void 0,p=e[0],m=e[1],y=e[2],g=r[0],v=r[1],b=r[2],w=n[0],M=n[1],x=n[2];return Math.abs(p-w)<l&&Math.abs(m-M)<l&&Math.abs(y-x)<l?te(t):(h=p-w,f=m-M,_=y-x,i=v*(_*=d=1/Math.sqrt(h*h+f*f+_*_))-b*(f*=d),o=b*(h*=d)-g*_,s=g*f-v*h,(d=Math.sqrt(i*i+o*o+s*s))?(i*=d=1/d,o*=d,s*=d):(i=0,o=0,s=0),a=f*s-_*o,u=_*i-h*s,c=h*o-f*i,(d=Math.sqrt(a*a+u*u+c*c))?(a*=d=1/d,u*=d,c*=d):(a=0,u=0,c=0),t[0]=i,t[1]=a,t[2]=h,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=_,t[11]=0,t[12]=-(i*p+o*m+s*y),t[13]=-(a*p+u*m+c*y),t[14]=-(h*p+f*m+_*y),t[15]=1,t)}function Pe(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=r[0],u=r[1],c=r[2],h=i-n[0],f=o-n[1],_=s-n[2],l=h*h+f*f+_*_;l>0&&(h*=l=1/Math.sqrt(l),f*=l,_*=l);var d=u*_-c*f,p=c*h-a*_,m=a*f-u*h;return(l=d*d+p*p+m*m)>0&&(d*=l=1/Math.sqrt(l),p*=l,m*=l),t[0]=d,t[1]=p,t[2]=m,t[3]=0,t[4]=f*m-_*p,t[5]=_*d-h*m,t[6]=h*p-f*d,t[7]=0,t[8]=h,t[9]=f,t[10]=_,t[11]=0,t[12]=i,t[13]=o,t[14]=s,t[15]=1,t}function Fe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Be(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function ke(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function De(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Le(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Oe(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Ne(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Ue(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],h=t[8],f=t[9],_=t[10],d=t[11],p=t[12],m=t[13],y=t[14],g=t[15],v=e[0],b=e[1],w=e[2],M=e[3],x=e[4],S=e[5],E=e[6],T=e[7],A=e[8],I=e[9],C=e[10],R=e[11],P=e[12],F=e[13],B=e[14],k=e[15];return Math.abs(n-v)<=l*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-b)<=l*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-w)<=l*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-M)<=l*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-x)<=l*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-S)<=l*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(u-E)<=l*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(c-T)<=l*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-A)<=l*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-I)<=l*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(_-C)<=l*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(d-R)<=l*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-P)<=l*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-F)<=l*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(y-B)<=l*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(g-k)<=l*Math.max(1,Math.abs(g),Math.abs(k))}var je=oe,Ge=De;function qe(){var t=new d(3);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function We(t){var e=new d(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ve(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function Xe(t,e,n){var r=new d(3);return r[0]=t,r[1]=e,r[2]=n,r}function He(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ye(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Ke(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ze(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ze(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Qe(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Je(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function $e(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function tn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function en(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function nn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function rn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function on(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function sn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}function an(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function un(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function cn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function hn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function fn(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function _n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ln(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2];return t[0]=i*u-o*a,t[1]=o*s-r*u,t[2]=r*a-i*s,t}function dn(t,e,n,r){var i=e[0],o=e[1],s=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t}function pn(t,e,n,r,i,o){var s=o*o,a=s*(2*o-3)+1,u=s*(o-2)+o,c=s*(o-1),h=s*(3-2*o);return t[0]=e[0]*a+n[0]*u+r[0]*c+i[0]*h,t[1]=e[1]*a+n[1]*u+r[1]*c+i[1]*h,t[2]=e[2]*a+n[2]*u+r[2]*c+i[2]*h,t}function mn(t,e,n,r,i,o){var s=1-o,a=s*s,u=o*o,c=a*s,h=3*o*a,f=3*u*s,_=u*o;return t[0]=e[0]*c+n[0]*h+r[0]*f+i[0]*_,t[1]=e[1]*c+n[1]*h+r[1]*f+i[1]*_,t[2]=e[2]*c+n[2]*h+r[2]*f+i[2]*_,t}function yn(t,e){e=e||1;var n=2*p()*Math.PI,r=2*p()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function gn(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,t}function vn(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function bn(t,e,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=e[0],u=e[1],c=e[2],h=i*c-o*u,f=o*a-r*c,_=r*u-i*a,l=i*_-o*f,d=o*h-r*_,p=r*f-i*h,m=2*s;return h*=m,f*=m,_*=m,l*=2,d*=2,p*=2,t[0]=a+h+l,t[1]=u+f+d,t[2]=c+_+p,t}function wn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Mn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function xn(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Sn(t,e){var n=Xe(t[0],t[1],t[2]),r=Xe(e[0],e[1],e[2]);fn(n,n),fn(r,r);var i=_n(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function En(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Tn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function An(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(n-o)<=l*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=l*Math.max(1,Math.abs(i),Math.abs(a))}var In=Ze,Cn=ze,Rn=Qe,Pn=sn,Fn=an,Bn=Ve,kn=un,Dn=function(){var t=qe();return function(e,n,r,i,o,s){var a=void 0,u=void 0;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}();function Ln(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function On(t){var e=new d(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Nn(t,e,n,r){var i=new d(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Un(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function jn(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Gn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function qn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Wn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Vn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Xn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Hn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Yn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function Kn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function Zn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function zn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Qn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function Jn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+o*o)}function $n(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function tr(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function er(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function nr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function rr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ir(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=o*s),t}function or(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function sr(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t[3]=a+r*(n[3]-a),t}function ar(t,e){var n,r,i,o,s,a;e=e||1;do{s=(n=2*p()-1)*n+(r=2*p()-1)*r}while(s>=1);do{a=(i=2*p()-1)*i+(o=2*p()-1)*o}while(a>=1);var u=Math.sqrt((1-s)/a);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t}function ur(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,t}function cr(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],u=n[2],c=n[3],h=c*r+a*o-u*i,f=c*i+u*r-s*o,_=c*o+s*i-a*r,l=-s*r-a*i-u*o;return t[0]=h*c+l*-s+f*-u-_*-a,t[1]=f*c+l*-a+_*-s-h*-u,t[2]=_*c+l*-u+h*-a-f*-s,t[3]=e[3],t}function hr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function fr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _r(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=e[0],a=e[1],u=e[2],c=e[3];return Math.abs(n-s)<=l*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=l*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=l*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=l*Math.max(1,Math.abs(o),Math.abs(c))}var lr=qn,dr=Wn,pr=Vn,mr=Jn,yr=$n,gr=tr,vr=er,br=function(){var t=Ln();return function(e,n,r,i,o,s){var a=void 0,u=void 0;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function wr(){var t=new d(4);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Mr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xr(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Sr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>l?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Er(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+s*a+i*c-o*u,t[1]=i*h+s*u+o*a-r*c,t[2]=o*h+s*c+r*u-i*a,t[3]=s*h-r*a-i*u-o*c,t}function Tr(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+s*a,t[1]=i*u+o*a,t[2]=o*u-i*a,t[3]=s*u-r*a,t}function Ar(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*a,t[1]=i*u+s*a,t[2]=o*u+r*a,t[3]=s*u-i*a,t}function Ir(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*a,t[1]=i*u-r*a,t[2]=o*u+s*a,t[3]=s*u-o*a,t}function Cr(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function Rr(t,e,n,r){var i=e[0],o=e[1],s=e[2],a=e[3],u=n[0],c=n[1],h=n[2],f=n[3],_=void 0,d=void 0,p=void 0,m=void 0,y=void 0;return(d=i*u+o*c+s*h+a*f)<0&&(d=-d,u=-u,c=-c,h=-h,f=-f),1-d>l?(_=Math.acos(d),p=Math.sin(_),m=Math.sin((1-r)*_)/p,y=Math.sin(r*_)/p):(m=1-r,y=r),t[0]=m*i+y*u,t[1]=m*o+y*c,t[2]=m*s+y*h,t[3]=m*a+y*f,t}function Pr(t){var e=p(),n=p(),r=p(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Fr(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=o*a,t}function Br(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function kr(t,e){var n=e[0]+e[4]+e[8],r=void 0;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*s+s]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*o+s]-e[3*s+o])*r,t[o]=(e[3*o+i]+e[3*i+o])*r,t[s]=(e[3*s+i]+e[3*i+s])*r}return t}function Dr(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(n),u=Math.cos(n),c=Math.sin(r),h=Math.cos(r);return t[0]=o*u*h-s*a*c,t[1]=s*a*h+o*u*c,t[2]=s*u*c-o*a*h,t[3]=s*u*h+o*a*c,t}function Lr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Or=On,Nr=Nn,Ur=Un,jr=jn,Gr=Gn,qr=Er,Wr=zn,Vr=or,Xr=sr,Hr=tr,Yr=Hr,Kr=er,Zr=Kr,zr=ir,Qr=fr,Jr=_r,$r=function(){var t=qe(),e=Xe(1,0,0),n=Xe(0,1,0);return function(r,i,o){var s=_n(i,o);return s<-.999999?(ln(t,e,i),Bn(t)<1e-6&&ln(t,n,i),fn(t,t),xr(r,t,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ln(t,i,o),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,zr(r,r))}}(),ti=function(){var t=wr(),e=wr();return function(n,r,i,o,s,a){return Rr(t,r,s,a),Rr(e,i,o,a),Rr(n,t,e,2*a*(1-a)),n}}(),ei=function(){var t=yt();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],zr(e,kr(e,t))}}();function ni(){var t=new d(8);return d!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function ri(t){var e=new d(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function ii(t,e,n,r,i,o,s,a){var u=new d(8);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=i,u[5]=o,u[6]=s,u[7]=a,u}function oi(t,e,n,r,i,o,s){var a=new d(8);a[0]=t,a[1]=e,a[2]=n,a[3]=r;var u=.5*i,c=.5*o,h=.5*s;return a[4]=u*r+c*n-h*e,a[5]=c*r+h*t-u*n,a[6]=h*r+u*e-c*t,a[7]=-u*t-c*e-h*n,a}function si(t,e,n){var r=.5*n[0],i=.5*n[1],o=.5*n[2],s=e[0],a=e[1],u=e[2],c=e[3];return t[0]=s,t[1]=a,t[2]=u,t[3]=c,t[4]=r*c+i*u-o*a,t[5]=i*c+o*s-r*u,t[6]=o*c+r*a-i*s,t[7]=-r*s-i*a-o*u,t}function ai(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function ui(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function ci(t,e){var n=wr();Me(n,e);var r=new d(3);return be(r,e),si(t,n,r),t}function hi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function fi(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function _i(t,e,n,r,i,o,s,a,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=s,t[6]=a,t[7]=u,t}var li=Ur;function di(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var pi=Ur;function mi(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function yi(t,e){var n=e[4],r=e[5],i=e[6],o=e[7],s=-e[0],a=-e[1],u=-e[2],c=e[3];return t[0]=2*(n*c+o*s+r*u-i*a),t[1]=2*(r*c+o*a+i*s-n*u),t[2]=2*(i*c+o*u+n*a-r*s),t}function gi(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=.5*n[0],u=.5*n[1],c=.5*n[2],h=e[4],f=e[5],_=e[6],l=e[7];return t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=s*a+i*c-o*u+h,t[5]=s*u+o*a-r*c+f,t[6]=s*c+r*u-i*a+_,t[7]=-r*a-i*u-o*c+l,t}function vi(t,e,n){var r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=a*s+h*r+u*o-c*i,_=u*s+h*i+c*r-a*o,l=c*s+h*o+a*i-u*r,d=h*s-a*r-u*i-c*o;return Tr(t,e,n),r=t[0],i=t[1],o=t[2],s=t[3],t[4]=f*s+d*r+_*o-l*i,t[5]=_*s+d*i+l*r-f*o,t[6]=l*s+d*o+f*i-_*r,t[7]=d*s-f*r-_*i-l*o,t}function bi(t,e,n){var r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=a*s+h*r+u*o-c*i,_=u*s+h*i+c*r-a*o,l=c*s+h*o+a*i-u*r,d=h*s-a*r-u*i-c*o;return Ar(t,e,n),r=t[0],i=t[1],o=t[2],s=t[3],t[4]=f*s+d*r+_*o-l*i,t[5]=_*s+d*i+l*r-f*o,t[6]=l*s+d*o+f*i-_*r,t[7]=d*s-f*r-_*i-l*o,t}function wi(t,e,n){var r=-e[0],i=-e[1],o=-e[2],s=e[3],a=e[4],u=e[5],c=e[6],h=e[7],f=a*s+h*r+u*o-c*i,_=u*s+h*i+c*r-a*o,l=c*s+h*o+a*i-u*r,d=h*s-a*r-u*i-c*o;return Ir(t,e,n),r=t[0],i=t[1],o=t[2],s=t[3],t[4]=f*s+d*r+_*o-l*i,t[5]=_*s+d*i+l*r-f*o,t[6]=l*s+d*o+f*i-_*r,t[7]=d*s-f*r-_*i-l*o,t}function Mi(t,e,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=e[0],u=e[1],c=e[2],h=e[3];return t[0]=a*s+h*r+u*o-c*i,t[1]=u*s+h*i+c*r-a*o,t[2]=c*s+h*o+a*i-u*r,t[3]=h*s-a*r-u*i-c*o,a=e[4],u=e[5],c=e[6],h=e[7],t[4]=a*s+h*r+u*o-c*i,t[5]=u*s+h*i+c*r-a*o,t[6]=c*s+h*o+a*i-u*r,t[7]=h*s-a*r-u*i-c*o,t}function xi(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[0],u=n[1],c=n[2],h=n[3];return t[0]=r*h+s*a+i*c-o*u,t[1]=i*h+s*u+o*a-r*c,t[2]=o*h+s*c+r*u-i*a,t[3]=s*h-r*a-i*u-o*c,a=n[4],u=n[5],c=n[6],h=n[7],t[4]=r*h+s*a+i*c-o*u,t[5]=i*h+s*u+o*a-r*c,t[6]=o*h+s*c+r*u-i*a,t[7]=s*h-r*a-i*u-o*c,t}function Si(t,e,n,r){if(Math.abs(r)<l)return hi(t,e);var i=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);r*=.5;var o=Math.sin(r),s=o*n[0]/i,a=o*n[1]/i,u=o*n[2]/i,c=Math.cos(r),h=e[0],f=e[1],_=e[2],d=e[3];t[0]=h*c+d*s+f*u-_*a,t[1]=f*c+d*a+_*s-h*u,t[2]=_*c+d*u+h*a-f*s,t[3]=d*c-h*s-f*a-_*u;var p=e[4],m=e[5],y=e[6],g=e[7];return t[4]=p*c+g*s+m*u-y*a,t[5]=m*c+g*a+y*s-p*u,t[6]=y*c+g*u+p*a-m*s,t[7]=g*c-p*s-m*a-y*u,t}function Ei(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Ti(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=n[4],u=n[5],c=n[6],h=n[7],f=e[4],_=e[5],l=e[6],d=e[7],p=n[0],m=n[1],y=n[2],g=n[3];return t[0]=r*g+s*p+i*y-o*m,t[1]=i*g+s*m+o*p-r*y,t[2]=o*g+s*y+r*m-i*p,t[3]=s*g-r*p-i*m-o*y,t[4]=r*h+s*a+i*c-o*u+f*g+d*p+_*y-l*m,t[5]=i*h+s*u+o*a-r*c+_*g+d*m+l*p-f*y,t[6]=o*h+s*c+r*u-i*a+l*g+d*y+f*m-_*p,t[7]=s*h-r*a-i*u-o*c+d*g-f*p-_*m-l*y,t}var Ai=Ti;function Ii(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var Ci=Vr;function Ri(t,e,n,r){var i=1-r;return Ci(e,n)<0&&(r=-r),t[0]=e[0]*i+n[0]*r,t[1]=e[1]*i+n[1]*r,t[2]=e[2]*i+n[2]*r,t[3]=e[3]*i+n[3]*r,t[4]=e[4]*i+n[4]*r,t[5]=e[5]*i+n[5]*r,t[6]=e[6]*i+n[6]*r,t[7]=e[7]*i+n[7]*r,t}function Pi(t,e){var n=Di(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Fi(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Bi=Hr,ki=Bi,Di=Kr,Li=Di;function Oi(t,e){var n=Di(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,i=e[1]/n,o=e[2]/n,s=e[3]/n,a=e[4],u=e[5],c=e[6],h=e[7],f=r*a+i*u+o*c+s*h;t[0]=r,t[1]=i,t[2]=o,t[3]=s,t[4]=(a-r*f)/n,t[5]=(u-i*f)/n,t[6]=(c-o*f)/n,t[7]=(h-s*f)/n}return t}function Ni(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Ui(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ji(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],h=e[0],f=e[1],_=e[2],d=e[3],p=e[4],m=e[5],y=e[6],g=e[7];return Math.abs(n-h)<=l*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=l*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-_)<=l*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-d)<=l*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=l*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-m)<=l*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(u-y)<=l*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-g)<=l*Math.max(1,Math.abs(c),Math.abs(g))}function Gi(){var t=new d(2);return d!=Float32Array&&(t[0]=0,t[1]=0),t}function qi(t){var e=new d(2);return e[0]=t[0],e[1]=t[1],e}function Wi(t,e){var n=new d(2);return n[0]=t,n[1]=e,n}function Vi(t,e){return t[0]=e[0],t[1]=e[1],t}function Xi(t,e,n){return t[0]=e,t[1]=n,t}function Hi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Yi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Ki(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Zi(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function zi(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Qi(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Ji(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function $i(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function to(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function eo(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function no(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function ro(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function io(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function oo(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function so(t){var e=t[0],n=t[1];return e*e+n*n}function ao(t,e){return t[0]=-e[0],t[1]=-e[1],t}function uo(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function co(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t}function ho(t,e){return t[0]*e[0]+t[1]*e[1]}function fo(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function _o(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}function lo(t,e){e=e||1;var n=2*p()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function po(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function mo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function yo(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function go(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}function vo(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],s=Math.sin(r),a=Math.cos(r);return t[0]=i*a-o*s+n[0],t[1]=i*s+o*a+n[1],t}function bo(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=n*n+r*r;s>0&&(s=1/Math.sqrt(s));var a=i*i+o*o;a>0&&(a=1/Math.sqrt(a));var u=(n*i+r*o)*s*a;return u>1?0:u<-1?Math.PI:Math.acos(u)}function wo(t){return"vec2("+t[0]+", "+t[1]+")"}function Mo(t,e){return t[0]===e[0]&&t[1]===e[1]}function xo(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=l*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))}var So=oo,Eo=Yi,To=Ki,Ao=Zi,Io=ro,Co=io,Ro=so,Po=function(){var t=Gi();return function(e,n,r,i,o,s){var a=void 0,u=void 0;for(n||(n=2),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}();n.d(e,"glMatrix",function(){return r}),n.d(e,"mat2",function(){return i}),n.d(e,"mat2d",function(){return o}),n.d(e,"mat3",function(){return s}),n.d(e,"mat4",function(){return a}),n.d(e,"quat",function(){return h}),n.d(e,"quat2",function(){return f}),n.d(e,"vec2",function(){return _}),n.d(e,"vec3",function(){return u}),n.d(e,"vec4",function(){return c})},function(t,e,n){"use strict";var r,i=n(30);window.onload=function(){var t=document.getElementById("mainCanvas");(r=new i(t,{})).init(),r.setupEvents(),r.startRun()},window.require&&window.require("electron").webFrame.setVisualZoomLevelLimits(1,1)},function(t,e,n){"use strict";var r=n(16).core,i=function(t){r.apply(this,arguments)};n(16).util.inherit(i,r),i.prototype.init=function(){r.prototype.init.apply(this,arguments)},t.exports=i},function(t,e,n){"use strict";var r={util:n(0),core:n(17),shader_program:n(13),constant:n(0).assign(n(2),{button:n(2)}),serif_manager:n(14),save_manager:n(6),manager:{save:n(6),scenario:n(14)},scene:{base:n(5),loading:n(9),movie:n(20)},object:{base:n(1),point:n(7),sprite:n(21),sprite3d:n(22),pool_manager:n(15),pool_manager3d:n(25),ui_parts:n(26)},asset_loader:{image:n(10),audio:n(11),font:n(12)},storage:{base:n(8),save:n(27)},Util:n(0),Core:n(17),ShaderProgram:n(13),Log:n(45),Constant:{Button:n(2)},Manager:{Save:n(6),Scenario:n(14),Time:n(19)},Scene:{Base:n(5),Loading:n(9),Movie:n(20)},Object:{Base:n(1),Point:n(7),Sprite:n(21),Sprite3d:n(22),Container:n(24),PoolManager:n(15),PoolManager3d:n(25),PoolContainer:n(15),UIParts:n(26),UI:{Base:n(4),Text:n(46),Spinner:n(47),Group:n(48),Image:n(49)}},AssetLoader:{Image:n(10),Audio:n(11),Font:n(12)},Storage:{Base:n(8),Save:n(27)},Master:{RepositoryGenerator:n(50)}};t.exports=r},function(t,e,n){(function(e){WebGLDebugUtils=function(){var t;void 0===t&&(t=e);var n=function(e){t.console&&t.console.error?t.console.error(e):function(e){t.console&&t.console.log&&t.console.log(e)}(e)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},i=null,o=null;function s(t){if(null==i)for(var e in i={},o={},t)"number"==typeof t[e]&&(i[t[e]]=e,o[e]=t[e])}function a(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function u(t){a();var e=i[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function c(t,e,n,i){var s;if(void 0!==(s=r[t])&&(void 0!==(s=s[e])&&s[n])){if("object"==typeof s[n]&&void 0!==s[n].enumBitwiseOr){for(var a=s[n].enumBitwiseOr,c=0,h=[],f=0;f<a.length;++f){var _=o[a[f]];0!=(i&_)&&(c|=_,h.push(u(_)))}return c===i?h.join(" | "):u(i)}return u(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function h(t,e,n){t.__defineGetter__(n,function(){return e[n]}),t.__defineSetter__(n,function(t){e[n]=t})}function f(t){var e=!!t.createTransformFeedback;e&&t.bindVertexArray(null);var n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);for(var i=0;i<n;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0),e&&t.vertexAttribDivisor(i,0);t.deleteBuffer(r);var o=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<o;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),e&&(t.bindTexture(t.TEXTURE_2D_ARRAY,null),t.bindTexture(t.TEXTURE_3D,null),t.bindSampler(i,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e){t.drawBuffers([t.BACK]),t.readBuffer(t.BACK),t.bindBuffer(t.COPY_READ_BUFFER,null),t.bindBuffer(t.COPY_WRITE_BUFFER,null),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.bindBuffer(t.PIXEL_UNPACK_BUFFER,null);var s=t.getParameter(t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS);for(i=0;i<s;++i)t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,i,null);var a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);for(i=0;i<a;++i)t.bindBufferBase(t.UNIFORM_BUFFER,i,null);t.disable(t.RASTERIZER_DISCARD),t.pixelStorei(t.UNPACK_IMAGE_HEIGHT,0),t.pixelStorei(t.UNPACK_SKIP_IMAGES,0),t.pixelStorei(t.UNPACK_ROW_LENGTH,0),t.pixelStorei(t.UNPACK_SKIP_ROWS,0),t.pixelStorei(t.UNPACK_SKIP_PIXELS,0),t.pixelStorei(t.PACK_ROW_LENGTH,0),t.pixelStorei(t.PACK_SKIP_ROWS,0),t.pixelStorei(t.PACK_SKIP_PIXELS,0),t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.DONT_CARE)}for(;t.getError(););}return{init:s,mightBeEnum:function(t){return a(),void 0!==i[t]},glEnumToString:u,glFunctionArgToString:c,glFunctionArgsToString:function(t,e){for(var n="",r=e.length,i=0;i<r;++i)n+=(0==i?"":", ")+c(t,r,i,e[i]);return n},makeDebugContext:function t(e,r,i,o){o=o||e,s(e),r=r||function(t,e,r){for(var i="",o=r.length,s=0;s<o;++s)i+=(0==s?"":", ")+c(e,o,s,r[s]);n("WebGL error "+u(t)+" in "+e+"("+i+")")};var a={};function f(t,e){return function(){i&&i(e,arguments);var n=t[e].apply(t,arguments),s=o.getError();return 0!=s&&(a[s]=!0,r(s,e,arguments)),n}}var _={};for(var l in e)if("function"==typeof e[l])if("getExtension"!=l)_[l]=f(e,l);else{var d=f(e,l);_[l]=function(){var n=d.apply(e,arguments);return n?t(n,r,i,o):null}}else h(_,e,l);return _.getError=function(){for(var t in a)if(a.hasOwnProperty(t)&&a[t])return a[t]=!1,t;return e.NO_ERROR},_},makeLostContextSimulatingCanvas:function(e){var n,r,i=[],o=[],s={},a=1,u=!1,c=[],_=0,l=0,d=!1,p=0,m={};function y(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}e.getContext=function(i){return function(){var o=i.apply(e,arguments);if(o instanceof WebGLRenderingContext||t.WebGL2RenderingContext&&o instanceof WebGL2RenderingContext){if(o!=n){if(n)throw"got different context";r=t.WebGL2RenderingContext&&o instanceof WebGL2RenderingContext,s=function(t){for(var e in t)"function"==typeof t[e]?s[e]=w(t,e):h(s,t,e);s.getError=function(){if(b(),!u)for(;t=n.getError();)m[t]=!0;for(var t in m)if(m[t])return delete m[t],t;return s.NO_ERROR};var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];r&&i.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var o=0;o<i.length;++o){var f=i[o];s[f]=function(e){return function(){if(b(),u)return null;var n=e.apply(t,arguments);return n.__webglDebugContextLostId__=a,c.push(n),n}}(t[f])}var _=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];r&&_.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var o=0;o<_.length;++o){var f=_[o];s[f]=function(e){return function(){return b(),u?null:e.apply(t,arguments)}}(s[f])}var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];r&&l.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var o=0;o<l.length;++o){var f=l[o];s[f]=function(e){return function(){return b(),!u&&e.apply(t,arguments)}}(s[f])}return s.checkFramebufferStatus=function(e){return function(){return b(),u?s.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(s.checkFramebufferStatus),s.getAttribLocation=function(e){return function(){return b(),u?-1:e.apply(t,arguments)}}(s.getAttribLocation),s.getVertexAttribOffset=function(e){return function(){return b(),u?0:e.apply(t,arguments)}}(s.getVertexAttribOffset),s.isContextLost=function(){return u},r&&(s.getFragDataLocation=function(e){return function(){return b(),u?-1:e.apply(t,arguments)}}(s.getFragDataLocation),s.clientWaitSync=function(e){return function(){return b(),u?s.WAIT_FAILED:e.apply(t,arguments)}}(s.clientWaitSync),s.getUniformBlockIndex=function(e){return function(){return b(),u?s.INVALID_INDEX:e.apply(t,arguments)}}(s.getUniformBlockIndex)),s}(n=o)}return s}return o}}(e.getContext);var g=function(t){i.push(y(t))},v=function(t){o.push(y(t))};function b(){++l,u||_==l&&e.loseContext()}function w(t,e){var n=t[e];return function(){if(b(),!u)return n.apply(t,arguments)}}function M(t){return{statusMessage:t,preventDefault:function(){d=!0}}}return function(t){var e=t.addEventListener;t.addEventListener=function(n,r,i){switch(n){case"webglcontextlost":g(r);break;case"webglcontextrestored":v(r);break;default:e.apply(t,arguments)}}}(e),e.loseContext=function(){if(!u){for(u=!0,_=0,++a;n.getError(););!function(){for(var t=Object.keys(m),e=0;e<t.length;++e)delete m[t[e]]}(),m[n.CONTEXT_LOST_WEBGL]=!0;var t=M("context lost"),r=i.slice();setTimeout(function(){for(var n=0;n<r.length;++n)r[n](t);p>=0&&setTimeout(function(){e.restoreContext()},p)},0)}},e.restoreContext=function(){u&&o.length&&setTimeout(function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var t=0;t<c.length;++t){var e=c[t];e instanceof WebGLBuffer?n.deleteBuffer(e):e instanceof WebGLFramebuffer?n.deleteFramebuffer(e):e instanceof WebGLProgram?n.deleteProgram(e):e instanceof WebGLRenderbuffer?n.deleteRenderbuffer(e):e instanceof WebGLShader?n.deleteShader(e):e instanceof WebGLTexture?n.deleteTexture(e):r&&(e instanceof WebGLQuery?n.deleteQuery(e):e instanceof WebGLSampler?n.deleteSampler(e):e instanceof WebGLSync?n.deleteSync(e):e instanceof WebGLTransformFeedback?n.deleteTransformFeedback(e):e instanceof WebGLVertexArrayObject&&n.deleteVertexArray(e))}}(),f(n),u=!1,l=0,d=!1;for(var t=o.slice(),e=M("context restored"),i=0;i<t.length;++i)t[i](e)},0)},e.loseContextInNCalls=function(t){if(u)throw"You can not ask a lost contet to be lost";_=l+t},e.getNumCalls=function(){return l},e.setRestoreTimeout=function(t){p=t},e},resetToInitialState:f}}(),t.exports=WebGLDebugUtils}).call(this,n(33))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var r=n(0),i=function(t){this.core=t,this.dom=null,this.is_debug_mode=!1,this._collision_area_color=null,this._is_showing_fps=!1,this._variables={},this._before_time=0,this._fps=0};i.prototype.init=function(){this._before_time=0,this._fps=0},i.prototype.setOn=function(t){this.is_debug_mode=!0,this.dom=t},i.prototype.setOff=function(){this.is_debug_mode=!1,this.dom=null},i.prototype.set=function(t,e){this.is_debug_mode&&(this._variables[t]=e)},i.prototype.get=function(t){return this.is_debug_mode?this._variables[t]:null},i.prototype.beforeRun=function(){this.isShowingFps()&&this._calculateFps()},i.prototype._calculateFps=function(){if(this.core.frame_count%60==0){var t=Date.now();this._before_time&&(this._fps=Math.floor(6e4/(t-this._before_time))),this._before_time=t}},i.prototype.afterRun=function(){this.isShowingFps()&&this._renderFps()},i.prototype._renderFps=function(){var t=this.core.ctx;t.save(),t.fillStyle="red",t.textAlign="left",t.font="16px 'sans-serif'",t.fillText("FPS: "+this._fps,this.core.width-70,this.core.height-10),t.restore()},i.prototype.addMenuText=function(t){if(this.is_debug_mode){var e=window.document.createElement("pre");e.textContent=t,this.dom.appendChild(e)}},i.prototype.addNewLine=function(){if(this.is_debug_mode){var t=window.document.createElement("br");this.dom.appendChild(t)}},i.prototype.addMenuImage=function(t){if(this.is_debug_mode){var e=window.document.createElement("img");e.src=t,this.dom.appendChild(e)}},i.prototype.addMenuButton=function(t,e){if(this.is_debug_mode){var n=this.core,r=window.document.createElement("input");r.setAttribute("type","button"),r.setAttribute("value",t),r.onclick=function(){e(n)},this.dom.appendChild(r)}},i.prototype.addMenuSelect=function(t,e,n){if(this.is_debug_mode){var r=this.core,i=window.document.createElement("select"),o=document.createElement("option");o.setAttribute("value",""),o.appendChild(document.createTextNode(t)),i.appendChild(o),i.onchange=function(){""!==i.value&&n(r,i.value)};for(var s=0,a=e.length;s<a;s++){var u=e[s],c=u.value,h=h in u?u.name:c,f=document.createElement("option");f.setAttribute("value",c),f.appendChild(document.createTextNode(h)),i.appendChild(f)}this.dom.appendChild(i)}},i.prototype.addGitLatestCommitInfo=function(t,e,n){if(this.is_debug_mode){n=n||"master";var r=window.document.createElement("pre");this.dom.appendChild(r);var i="https://api.github.com/repos/"+t+"/"+e+"/branches/"+n,o=new XMLHttpRequest;o.onload=function(){if(200===o.status){var t,e=o.response;if(!e)throw new Error("Can't parse git lastest commit info");t=JSON.parse(e),r.textContent="last update date: "+new Date(t.commit.commit.author.date)+"\n"}},o.open("GET",i,!0),o.send(null)}};i.prototype.addCaputureImageButton=function(t,e){if(this.is_debug_mode){var n=this.core.canvas_dom;this.addMenuButton(t,function(){var t=e;if(void 0===e){var i=new Date;t=Math.floor(i.getTime()/1e3)}var o=function(t){for(var e=t.split(","),n=atob(e[1]),r=e[0].split(":")[1].split(";")[0],i=new Uint8Array(n.length),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);return new Blob([i],{type:r})}(n.toDataURL("image/png"));r.downloadBlob(o,t+".png")})}};var o={array_buffer:"readAsArrayBuffer",binary_string:"readAsBinaryString",text:"readAsText",data_url:"readAsDataURL"};i.prototype.addUploadFileButton=function(t,e,n){if(this.is_debug_mode){if(void 0===n&&(n="array_buffer"),!o[n])throw new Error("Unknown read_type: "+n);var r=window.document.createElement("pre");r.style.display="inline",r.textContent=t,this.dom.appendChild(r);var i=window.document.createElement("input");i.setAttribute("type","file");var s=o[n],a=this.core;i.onchange=function(t){if(i.value){var n=t.target.files[0],r=new FileReader,o=n.type;r.onload=function(t){var n=t.target.result;e(a,o,n)},r[s](n)}},i.onclick=function(t){i.value=null},this.dom.appendChild(i)}},i.prototype.setShowingCollisionAreaOn=function(t){if(!this.is_debug_mode)return null;t=t||"white",this._collision_area_color=t},i.prototype.setShowingCollisionAreaOff=function(){if(!this.is_debug_mode)return null;this._collision_area_color=null},i.prototype.isShowingCollisionArea=function(){return!!this.is_debug_mode&&!!this._collision_area_color},i.prototype.collisionAreaColor=function(){return this.is_debug_mode?this._collision_area_color:null},i.prototype.setShowingFpsOn=function(){if(!this.is_debug_mode)return null;this._is_showing_fps=!0},i.prototype.setShowingFpsOff=function(){if(!this.is_debug_mode)return null;this._is_showing_fps=!1},i.prototype.isShowingFps=function(){return!!this.is_debug_mode&&this._is_showing_fps},t.exports=i},function(t,e,n){"use strict";var r=n(9),i=function(t){this.core=t,this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._scenes={},this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null,this._is_fade_out_finished=!1,this.addScene("loading",new r(t))};i.prototype.init=function(){this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null,this._is_fade_out_finished=!1},i.prototype.beforeRun=function(){this._changeNextSceneIfReserved()},i.prototype.currentScene=function(){return null===this._current_scene?null:this._scenes[this._current_scene]},i.prototype.addScene=function(t,e){this._scenes[t]=e},i.prototype.changeScene=function(t,e){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");var n=Array.prototype.slice.call(arguments);this._reserved_next_scene_name_and_arguments=n,this._is_reserved_next_scene_init=!0,this._current_scene||this._changeNextSceneIfReserved()},i.prototype.returnScene=function(t){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");this._reserved_next_scene_name_and_arguments=[t],this._is_reserved_next_scene_init=!1},i.prototype._changeNextSceneIfReserved=function(){if(this._reserved_next_scene_name_and_arguments)if(!this.isSetFadeOut()||this._is_fade_out_finished||this.isInFadeOut())if(this.isSetFadeOut()&&!this._is_fade_out_finished&&this.isInFadeOut());else{this._current_scene=this._reserved_next_scene_name_and_arguments.shift();var t=this.currentScene(),e=this._reserved_next_scene_name_and_arguments;this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init&&(this._resetFadeOut(),t.init.apply(t,e)),this._is_fade_out_finished=!1}else this.startFadeOut()},i.prototype.changeSceneWithLoading=function(t,e){e||(e={}),this.changeScene("loading",e,t)},i.prototype.setFadeIn=function(t,e){this._fade_in_duration=t||30,this._fade_in_color=e||"white",this._startFadeIn()},i.prototype._startFadeIn=function(){this._quitFadeOut(),this._fade_in_start_frame_count=this.core.frame_count},i.prototype._quitFadeIn=function(){this._fade_in_start_frame_count=null},i.prototype.isInFadeIn=function(){return null!==this._fade_in_start_frame_count},i.prototype.setFadeOut=function(t,e){t=void 0!==t?t:30,this._fade_out_duration=t,this._fade_out_color=e||"black"},i.prototype._resetFadeOut=function(){this._fade_out_duration=null,this._fade_out_color=null},i.prototype.startFadeOut=function(){this.isSetFadeOut()&&(this._quitFadeIn(),this._fade_out_start_frame_count=this.core.frame_count)},i.prototype._quitFadeOut=function(){this._fade_out_start_frame_count=null},i.prototype.isInFadeOut=function(){return null!==this._fade_out_start_frame_count},i.prototype.isSetFadeOut=function(){return!(!this._fade_out_duration||!this._fade_out_color)},i.prototype.drawTransition=function(){var t,e=this.core.ctx;this.isInFadeIn()?(e.save(),t=this.core.frame_count-this._fade_in_start_frame_count<this._fade_in_duration?1-(this.core.frame_count-this._fade_in_start_frame_count)/this._fade_in_duration:0,e.globalAlpha=t,e.fillStyle=this._fade_in_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),0===t&&this._quitFadeIn()):this.isInFadeOut()&&(e.save(),t=this.core.frame_count-this._fade_out_start_frame_count<this._fade_out_duration?(this.core.frame_count-this._fade_out_start_frame_count)/this._fade_out_duration:1,e.globalAlpha=t,e.fillStyle=this._fade_out_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),1===t&&(this._quitFadeOut(),this._is_fade_out_finished=!0))},t.exports=i},function(t,e,n){"use strict";n(37),n(38),n(39),n(40),t.exports=n(3)},function(t,e,n){"use strict";var r=n(2),i=n(3);i.prototype.getAnyButtonId=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads()[0];if(t)for(var e=0;e<t.buttons.length;e++)if(t.buttons[e].pressed)return e}},i.prototype._getKeyByButtonId=function(t){var e=this._button_id_to_key_bit_code[t];return e||(e=0),e},i.prototype._handleGamePad=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads()[0];if(t){for(var e=0,n=t.buttons.length;e<n;e++)e in this._button_id_to_key_bit_code&&(t.buttons[e].pressed?this._current_keyflag|=this._getKeyByButtonId(e):this._current_keyflag&=~this._getKeyByButtonId(e));t.axes[1]<-.5?this._current_keyflag|=r.BUTTON_UP:this._current_keyflag&=~r.BUTTON_UP,t.axes[1]>.5?this._current_keyflag|=r.BUTTON_DOWN:this._current_keyflag&=~r.BUTTON_DOWN,t.axes[0]<-.5?this._current_keyflag|=r.BUTTON_LEFT:this._current_keyflag&=~r.BUTTON_LEFT,t.axes[0]>.5?this._current_keyflag|=r.BUTTON_RIGHT:this._current_keyflag&=~r.BUTTON_RIGHT}}},t.exports=i},function(t,e,n){"use strict";var r=n(2),i=n(3);i.prototype.isKeyDown=function(t){return!!(this._current_keyflag&t)},i.prototype.isKeyPush=function(t){return!(this._before_keyflag&t)&&this._current_keyflag&t},i.prototype.isKeyRelease=function(t){return this._before_keyflag&t&&!(this._current_keyflag&t)},i.prototype.getKeyDownTime=function(t){return this._key_bit_code_to_down_time[t]},i.prototype._initPressedKeyTime=function(){for(var t in this._key_bit_code_to_down_time={},r){var e=r[t];this._key_bit_code_to_down_time[e]=0}},i.prototype._setPressedKeyTime=function(){for(var t in r){var e=r[t];this.isKeyDown(e)?++this._key_bit_code_to_down_time[e]:this._key_bit_code_to_down_time[e]=0}},i.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=r.BUTTON_SHIFT;break;case 32:e=r.BUTTON_SPACE;break;case 37:e=r.BUTTON_LEFT;break;case 38:e=r.BUTTON_UP;break;case 39:e=r.BUTTON_RIGHT;break;case 40:e=r.BUTTON_DOWN;break;case 88:e=r.BUTTON_X;break;case 90:e=r.BUTTON_Z}return e},i.prototype._handleKeyDown=function(t){this._current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},i.prototype._handleKeyUp=function(t){this._current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},t.exports=i},function(t,e,n){"use strict";var r=n(7),i=n(3);i.prototype.isLeftClickDown=function(){return this._is_left_clicked},i.prototype.isLeftClickPush=function(){return this._is_left_clicked&&!this._before_is_left_clicked},i.prototype.isLeftClickRelease=function(){return!this._is_left_clicked&&this._before_is_left_clicked},i.prototype.isRightClickDown=function(){return this._is_right_clicked},i.prototype.isRightClickPush=function(){return this._is_right_clicked&&!this._before_is_right_clicked},i.prototype.isRightClickRelease=function(){return!this._is_right_clicked&&this._before_is_right_clicked},i.prototype.mousePositionPoint=function(t){var e=this.mousePositionX(),n=this.mousePositionY(),i=new r(t);return i.init(),i.setPosition(e,n),i},i.prototype.mouseScroll=function(){return this._mouse_scroll},i.prototype.mousePositionX=function(){return this._mouse_x},i.prototype.mousePositionY=function(){return this._mouse_y},i.prototype.mouseMoveX=function(){return this._mouse_change_x},i.prototype.mouseMoveY=function(){return this._mouse_change_y},i.prototype._handleMouseDown=function(t){"which"in t?(this._is_left_clicked=1===t.which,this._is_right_clicked=3===t.which):"button"in t&&(this._is_left_clicked=1===t.button,this._is_right_clicked=2===t.button),t.preventDefault()},i.prototype._handleMouseUp=function(t){"which"in t?(this._is_left_clicked=1!==t.which&&this._is_left_clicked,this._is_right_clicked=3!==t.which&&this._is_right_clicked):"button"in t&&(this._is_left_clicked=1!==t.button&&this._is_left_clicked,this._is_right_clicked=2!==t.button&&this._is_right_clicked),t.preventDefault()},i.prototype._handleMouseMove=function(t){var e=(t=t||window.event).target.getBoundingClientRect(),n=(t.clientX-e.left)*this._click_position_width_ratio,r=(t.clientY-e.top)*this._click_position_height_ratio;this._mouse_change_x=this._mouse_x-n,this._mouse_change_y=this._mouse_y-r,this._mouse_x=n,this._mouse_y=r,t.preventDefault()},i.prototype._handleMouseWheel=function(t){this._mouse_scroll=t.detail?t.detail:-t.wheelDelta/120},t.exports=i},function(t,e,n){"use strict";var r=n(7),i=n(3);i.prototype.getTouch=function(t){if(t>this._touch_ids.length-1)return this._nullTouch();var e=this._touch_ids[t];return new o(this,e)},i.prototype.getAllTouchList=function(){for(var t=[],e=0,n=this._touch_ids.length;e<n;e++){var r=this._touch_ids[e];t.push(new o(this,r))}return t},i.prototype.getTouchList=function(){for(var t=[],e=0,n=this._touch_ids.length;e<n;e++){var r=this._touch_ids[e];r in this._is_touched_map&&t.push(new o(this,r))}return t},i.prototype._nullTouch=function(){return new o(this,-1)},i.prototype._handleTouchDown=function(t){t.preventDefault();for(var e=t.target.getBoundingClientRect(),n=t.changedTouches,r=0,i=n.length;r<i;r++){var o=n[r],s=o.identifier;!function(t,e){for(var n=null,r=0,i=t._touch_ids.length;r<i;r++){if(!(t._touch_ids[r]in t._is_touched_map)){n=r;break}}null===n?n=t._touch_ids.length:delete t._touch_infos[t._touch_ids[n]],t._touch_ids[n]=e}(this,s);var a=(o.clientX-e.left)*this._click_position_width_ratio,u=(o.clientY-e.top)*this._click_position_height_ratio;this._touch_infos[s]={x:a,y:u,change_x:0,change_y:0},this._is_touched_map[s]=!0}},i.prototype._handleTouchUp=function(t){t.preventDefault();for(var e=t.changedTouches,n=0,r=e.length;n<r;n++){var i=e[n].identifier;delete this._is_touched_map[i]}},i.prototype._handleTouchMove=function(t){t.preventDefault();for(var e=t.target.getBoundingClientRect(),n=t.changedTouches,r=0,i=n.length;r<i;r++){var o=n[r],s=o.identifier;if(s in this._touch_infos){var a=o.clientX-e.left,u=o.clientY-e.top,c=this._touch_infos[s];c.change_x=c.x-a,c.change_y=c.y-u,c.x=a,c.y=u}}};var o=function(t,e){this._input_manager=t,this._id=e};o.prototype.isEnable=function(){return this._id in this._input_manager._touch_infos},o.prototype.isTouching=function(){return this._id in this._input_manager._is_touched_map},o.prototype.isTap=function(){return this.isTouching()&&!(this._id in this._input_manager._before_is_touched_map)},o.prototype.isTouchRelease=function(){return!this.isTouching()&&this._id in this._input_manager._before_is_touched_map},o.prototype.positionPoint=function(t){var e=this.x(),n=this.y(),i=new r(t);return i.init(),i.setPosition(e,n),i},o.prototype.x=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].x:0},o.prototype.y=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].y:0},o.prototype.moveX=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].change_x:0},o.prototype.moveY=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].change_y:0},t.exports=i},function(t,e,n){"use strict";var r=n(8),i=function(t){r.apply(this,arguments)};n(0).inherit(i,r);var o="hakurei_engine",s="scenario";i.KEY=function(){return!this.isLocalMode()&&window&&window.location?[o,s,window.location.pathname].join(":"):s},i.prototype.getSerifStatus=function(t){var e=this.get(t);return e||(e={}),e},i.prototype.getPlayedCount=function(t){return this.getSerifStatus(t).played_count||0},i.prototype.incrementPlayedCount=function(t){var e=this.getSerifStatus(t);e.played_count=e.played_count||0,e.played_count++,this.set(t,e)},i.prototype.resetPlayedCount=function(t){var e=this.getSerifStatus(t);e.played_count=0,this.set(t,e)},t.exports=i},function(t,e,n){"use strict";t.exports="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n\tvec4 textureColor = texture2D(uSampler, vTextureCoordinates);\n\tgl_FragColor = textureColor * vColor;\n}\n\n"},function(t,e,n){"use strict";t.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoordinates;\nattribute vec4 aColor;\n\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n\tvTextureCoordinates = aTextureCoordinates;\n\tvColor = aColor;\n}\n\n"},function(t,e,n){"use strict";var r=function(t){};r.prototype.init=function(t){return console.error("this method is abolished.")},r.prototype.setAutoStart=function(t){return console.error("this method is abolished.")},r.prototype.isEnd=function(){return console.error("this method is abolished.")},r.prototype.isStart=function(){return console.error("this method is abolished.")},r.prototype.next=function(){return console.error("this method is abolished.")},r.prototype._showBackground=function(t){return console.error("this method is abolished.")},r.prototype._showChara=function(t){return console.error("this method is abolished.")},r.prototype._setOption=function(t){return console.error("this method is abolished.")},r.prototype._printMessage=function(t){return console.error("this method is abolished.")},r.prototype.isWaitingNext=function(){return console.error("this method is abolished.")},r.prototype.isEndPrinting=function(){return console.error("this method is abolished.")},r.prototype._startPrintMessage=function(){return console.error("this method is abolished.")},r.prototype._cancelPrintMessage=function(){return console.error("this method is abolished.")},r.prototype.startPrintMessage=function(){return console.error("this method is abolished.")},r.prototype.cancelPrintMessage=function(){return console.error("this method is abolished.")},r.prototype.isBackgroundChanged=function(){return console.error("this method is abolished.")},r.prototype.getBackgroundImageName=function(){return console.error("this method is abolished.")},r.prototype.getImageName=function(t){return console.error("this method is abolished.")},r.prototype.getChara=function(t){return console.error("this method is abolished.")},r.prototype.isTalking=function(t){return console.error("this method is abolished.")},r.prototype.getOption=function(){return console.error("this method is abolished.")},r.prototype.lines=function(){return console.error("this method is abolished.")},r.prototype.getSerifRowsCount=function(){return console.error("this method is abolished.")},r.prototype.right_image=function(){return console.error("this method is abolished.")},r.prototype.left_image=function(){return console.error("this method is abolished.")},r.prototype.is_right_talking=function(){return console.error("this method is abolished.")},r.prototype.is_left_talking=function(){return console.error("this method is abolished.")},r.prototype.font_color=function(){return console.error("this method is abolished.")},r.prototype.is_end=function(){return console.error("this method is abolished.")},r.prototype.is_background_changed=function(){return console.error("this method is abolished.")},r.prototype.background_image=function(){return console.error("this method is abolished.")},t.exports=r},function(t,e,n){"use strict";var r=function(){this._mode=this.ERROR,this._generateFunction()};r.prototype.DEBUG=0,r.prototype.INFO=1,r.prototype.WARN=2,r.prototype.ERROR=3;var i={};i[r.prototype.DEBUG]={name:"debug",logger:function(){console.log.apply(console,arguments)}},i[r.prototype.INFO]={name:"info",logger:function(){console.info.apply(console,arguments)}},i[r.prototype.WARN]={name:"warn",logger:function(){console.warn.apply(console,arguments)}},i[r.prototype.ERROR]={name:"error",logger:function(){console.error.apply(console,arguments)}},r.prototype.setMode=function(t){this._mode=t,this._generateFunction()},r.prototype.mode=function(){return this._mode},r.prototype._generateFunction=function(){for(var t in i){var e=i[t],n=e.name,r=e.logger;this.mode()<=t?this[n]=r:this[n]=function(){}}},t.exports=new r},function(t,e,n){"use strict";var r=n(4),i=n(0),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{text:e.text||"",textColor:e.textColor||"black",textSize:e.textSize||"24px",textAlign:e.textAlign||"left"})};i.inherit(o,r),i.defineProperty(o,"text"),i.defineProperty(o,"textColor"),i.defineProperty(o,"textSize"),i.defineProperty(o,"textAlign"),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.text(this._default_property.text),this.textColor(this._default_property.textColor),this.textSize(this._default_property.textSize),this.textAlign(this._default_property.textAlign)},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;t.save(),t.fillStyle=this.textColor(),t.textAlign=this.textAlign(),t.font=this.textSize()+" 'sans-serif'",t.fillText(this.text(),this.x(),this.y()),t.restore(),r.prototype.draw.apply(this,arguments)}},t.exports=o},function(t,e,n){"use strict";var r=n(4),i=n(0),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{size:e.size||"",color:e.color||"black"})};i.inherit(o,r),i.defineProperty(o,"size"),i.defineProperty(o,"color"),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.size(this._default_property.size),this.color(this._default_property.color),this._start=new Date},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx,e=Math.floor(this.frame_count/60*16)/16;t.save(),t.translate(this.x(),this.y()),t.rotate(2*Math.PI*e);for(var n=0;n<16;n++)t.beginPath(),t.rotate(2*Math.PI/16),t.moveTo(this.size()/10,0),t.lineTo(this.size()/4,0),t.lineWidth=this.size()/30,t.globalAlpha=n/16,t.strokeStyle=this.color(),t.stroke();t.restore(),r.prototype.draw.apply(this,arguments)}},o.prototype.width=function(){return this.size()/2},o.prototype.height=function(){return this.size()/2},t.exports=o},function(t,e,n){"use strict";var r=n(4),i=n(0),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{width:e.width||0,height:e.height||0,backgroundColor:e.backgroundColor||null,alpha:e.alpha||1})};i.inherit(o,r),i.defineProperty(o,"width"),i.defineProperty(o,"height"),i.defineProperty(o,"backgroundColor"),i.defineProperty(o,"alpha"),o.prototype.init=function(){r.prototype.init.apply(this,arguments),this.width(this._default_property.width),this.height(this._default_property.height),this.backgroundColor(this._default_property.backgroundColor),this.alpha(this._default_property.alpha)},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;this.backgroundColor()&&(t.save(),t.translate(this.x(),this.y()),t.fillStyle=this.backgroundColor(),t.globalAlpha=this.alpha(),t.fillRect(-this.width()/2,-this.height()/2,this.width(),this.height()),t.restore()),r.prototype.draw.apply(this,arguments)}},t.exports=o},function(t,e,n){"use strict";var r=n(4),i=n(0),o=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=i.assign(this._default_property,{image_name:e.image_name||null,scale:e.scale||1,width:e.width||null,height:e.height||null})};i.inherit(o,r),i.defineProperty(o,"image_name"),i.defineProperty(o,"scale"),i.defineProperty(o,"width"),i.defineProperty(o,"height"),o.prototype.init=function(){if(r.prototype.init.apply(this,arguments),this.image_name(this._default_property.image_name),this.scale(this._default_property.scale),this.width(this._default_property.width),this.height(this._default_property.height),!this.width()&&!this.height()){var t=this.core.image_loader.getImage(this.image_name());this.width(t.width*this.scale()),this.height(t.height*this.scale())}},o.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},o.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.image_name()),e=t.width*this.scale(),n=t.height*this.scale(),i=this.core.ctx;i.save(),i.translate(this.x(),this.y()),i.drawImage(t,-e/2,-n/2,e,n),i.restore(),r.prototype.draw.apply(this,arguments)}},t.exports=o},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=n(51),o={exec:function(t,e,n){if(!t||"object"!==(void 0===t?"undefined":r(t)))throw new Error("type_info argument must be set");if(e=e||{pk:null,validate:!1},n=n||[],!e.pk)throw new Error("pk option must be set");for(var o=i.exec(t,e),s={},a=[],u=0,c=n.length;u<c;u++){var h=n[u];if(!(e.pk in h))throw new Error(e.pk+" key data does not exists in master data (index: "+u+")");var f=h[e.pk],_=new o(h);s[f]=_,a[u]=_}var l={};return l.DAOClass=o,l.find=function(t){return s[t]},l.all=function(){return a},l}};t.exports=o},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i={exec:function(t,e){if(!t||"object"!==(void 0===t?"undefined":r(t)))throw new Error("type_info argument must be set");if(!(e=e||{pk:null}).pk)throw new Error("pk option must be set");var n=function(t){this._data=t||{}};for(var i in t)!function(t){n.prototype[t]=function(){return this._data[t]}}(i);return n}};t.exports=i}]);